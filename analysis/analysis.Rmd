---
title: "Analysis"
author: ""
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
#install.packages("rwunderground")
library(rwunderground)
```

## 1. Introduction



## 2. Data

Data presentation.

```{r Filtering Data for Carriage, eval=FALSE}
Carriage_heating_oil <- table_heating_oil_case_study |>
  filter(Building == "Carriage") |>
  mutate()

Carriage_electricity <- table_electricity_case_study |>
  filter(Building == "Carriage  House") |>
  mutate()
```

```{r Dual Plot for Carriage, eval=FALSE}
  ggplot() +
  geom_line(Carriage_heating_oil, mapping = aes(x = `Delivery Date`, y = Gallons), color = "blue") + 
  geom_line(Carriage_electricity, mapping = aes(x = Month, y = KWH), color = "red") +
  scale_y_continuous(
    name = "Gallons filled",
    sec.axis = sec_axis(trans = ~.*1, name="KWH billed for"))+
  geom_vline(xintercept=as.POSIXct(as.Date("2021-08-01")),
                linetype=3, colour="black")#+
   #annotate("text", x=1, y=500, label="David started as the Director of Energy", angle=90)
  
```

```{r Cottage_heating_oil}
Cottage_heating_oil <- table_heating_oil_case_study |>
  filter(Building == "Cottage") |>
  mutate()

Cottage_electricity <- table_electricity_case_study |>
  filter(Building == "Cotttage House") |>
  mutate()
```

```{r Dual Plot for Carriage, eval=FALSE}
  ggplot() +
  geom_line(Cottage_heating_oil, mapping = aes(x = `Delivery Date`, y = Gallons), color = "blue") + 
  geom_line(Cottage_electricity, mapping = aes(x = Month, y = KWH), color = "red") +
  scale_y_continuous(
    name = "Gallons filled",
    sec.axis = sec_axis(trans = ~.*1, name="KWH billed for"))
```

```{r Humidity}
Humidity_ambient |>
  ggplot()+
  geom_line(aes(x = time, y = value))

```

```{r Temperature}
Temperature_ambient |>
  ggplot()+
  geom_line(aes(x = time, y = value))
```

```{r VocIndex}
vocIndex |>
  ggplot()+
  geom_line(aes(x = time, y = value))
```

```{r massConcentration}
massConcentrationPm2p5 |>
  ggplot()+
  geom_line(aes(x = time, y = value))
```

```{r Downloading wunderground data, eval=FALSE}

history(set_location(zip_code = 04609), date = 20240321) #testided with multiplelocation calls (stationID, Town Name etc.)

```

```{r test Downloading wunderground data, eval=FALSE}
#Found in Stackoverflow but cant figure the (i) part. https://stackoverflow.com/questions/58342525/how-to-extract-data-from-weather-underground-wunderground-into-csv-files

start_date <- as.POSIXct("2019-09-01",tz="est")
end_date <-  as.POSIXct(Sys.Date(),tz="est")

dates <- seq.POSIXt(start_date,end_date,by="day")

my_dates<-as.integer(unlist(strsplit(as.character(dates),"-")))

my_dates<-array(my_dates,dim=c(3,length(my_dates)/3))

my_dates<-as.data.frame(t(my_dates), )

colnames(my_dates)<-c("year","month","day")

station <- "KMECRANB5"


for(i in 1:nrow(my_dates)) {

  myurl[i] <- paste("https://www.wunderground.com/weatherstation/WXDailyHistory.asp?ID=",station,"&day=",my_dates$day[i],"&month=",my_dates$month[i],"&year=",my_dates$year[i],"&graphspan=day&format=1", sep = "") #I think the website changed so there is no URL that has just history it's now incorporated in dashboard. Can't see history table only by individula day,week, month.
  folder <- "D:\\WeatherData"
  myfile[i] <- paste("CrandberryWeather",i,".csv")
  download.file(url = myurl[i], file.path(folder, myfile[i], fsep = "\\" ))
}
```


## 3. Data analysis plan



