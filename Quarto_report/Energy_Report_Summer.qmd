---
title: ""
format:
  html:
    css: styles.css
  pdf:
    css: styles.css
  docx:
    css: styles.css
editor: source
params:
  adress: "Me_test1"
  author: "Rudolfs"
toc: false

---

```{r}
#| label: load packages
#| echo: false
#| warning: false

#Attach Packages
library(readr)
library(here)
library(dplyr)
library(ggplot2)
library(stringr)
library(readxl)
library(tidyverse)
library(gridExtra)
library(grid)
library(jpeg)
library(cowplot)
library(googlesheets4)
library(reticulate)
library(gt)

```

```{r}
#| label: setup data
#| echo: false
#| warning: false

#Load Data
Energy_Audits <- read_excel("../data/Energy_Audit_template.xlsx")

Building_Audit <- Energy_Audits |>
  filter(Adress_Name == params$adress) # Auditor_full_name == params$Auditor_full_name

```

```{r}
#| label: load googlesheets data
#| echo: false
#| warning: false

#Load Data
energy_test_googlesheets <- read_sheet("https://docs.google.com/spreadsheets/d/1NLoDskkQKP9rJdX1TPIwwy_xLSv0wcp77KCfG0lVxCc/edit?resourcekey=&gid=755427871#gid=755427871")

```

```{r}
#| label: setup rank recommendations data
#| echo: false
#| warning: false


recommendations <- energy_test_googlesheets |>
  #filter(Adress_Name == params$adress) |> #need to parametorize
  select("[Furnace tune-up]":"[Other]")

pivot_recommendations <- recommendations |>
  pivot_longer(cols = "[Furnace tune-up]":"[Other]",
    names_to = "Recommendation", 
    values_to = "Rank")

pivot_recommendations['Description'] <- c("Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation","Description of Recommendation")

ranked_recommendations <- pivot_recommendations |>
  mutate(Recommendation = recode(Recommendation,  '[Furnace tune-up]' = 'Furnace tune-up', '[Low-flow showerhead(s)]' = 'Low-flow showerhead(s)', '[LEDs]' = 'LEDs', '[Window Dressers]' = 'Window Dressers', '[Refrigerator]' = 'Refrigerator', '[Freezer]' = 'Freezer', '[Induction Stove]' = 'Induction Stove', '[Heat Pump Water Heater]' = 'Heat Pump Water Heater', '[Gutters]' = 'Gutters', '[Bathroom exhaust fan]' = 'Bathroom exhaust fan', '[Kitchen exhaust fan]' = 'Kitchen exhaust fan', '[Vapor Barrier]' = 'Vapor Barrier', '[Spray Foam]' = 'Spray Foam', '[Attic Insulation ]' = 'Attic Insulation', '[Wall Insulation]' = 'Wall Insulation', '[Electrical Panel Upgrade]' = 'Electrical Panel Upgrade', '[Air Source Heat Pump]'= 'Air Source Heat Pump', '[EV+charger]' = 'EV+charger', '[Solar]' = 'Solar', '[Other]' = 'Other')) |>
    arrange((Rank))|>
    filter(Rank != 0)

ranked_clean_recommendations <- ranked_recommendations|>
    select(-Rank)
```

```{r}
#| label: Setup basics data
#| echo: false
#| warning: false

double_basics <- energy_test_googlesheets |>
  select(`Date Built`, `Number of floors`, `Volume of conditioned space`, `Square footage of conditioned space`, `Thickness of the attic insulation (inches), at the thinnest location`, `Gallons of Heating Oil`,`Cost in Dollars...84`,`Gallons of Kerosene`,`Cost in Dollars...88`,`Gallons of Propane`,`Cost in Dollars...91`,`kWh of Electricity`,`Cost in Dollars...94`,`Cords of Firewood`,`Cost in Dollars...97`,`Tons of pellets`,`Cost in Dollars...100`,`Write the quantity and measuring unit`, `Cost in Dollars...103` )

character_basics <- energy_test_googlesheets |>
  select( `Foundation Type`, `Attic insulation type`, `Quality of attic insulation's installation? Assess worst part of installation.`,`Ambient Carbon Monoxide reading`,)

pivot_double_basics <- double_basics |>
  pivot_longer(cols = "Date Built":"Cost in Dollars...103",
    names_to = "Info", 
    values_to = "Values")

pivot_character_basics <- character_basics |>
  pivot_longer(cols = "Foundation Type":"Ambient Carbon Monoxide reading",
    names_to = "Info", 
    values_to = "Values")

all_basics <- pivot_double_basics |>
  rbind(pivot_character_basics) |>
  filter(Values != is.na(NA))
```


# Energy Audit Report {.bheader}

```{r}
#| label: house image path setup
#| echo: false
#| warning: false

# Unique identifier for the image
image_id <- "House_photo_placeholder"

# Generate the file path for the image based on the identifier
image_path <- paste0("", image_id, ".png")


```

```{r, out.width = "50%", fig.align = 'center'}
#| label: image render
#| echo: false
#| warning: false
#| eval: false

# Include the image in the report
knitr::include_graphics(image_path,)
```

Homeowner: `r params$adress`

Address: `r params$adress`

Auditors: `r params$author`

Contact: mdicommunityenergy\@coa.edu, 802 266 0301

Date: `r format(Sys.time(), '%e %B %Y')`

------------------------------------------------------------------------

We conducted an energy assessment of your home on `r Building_Audit$Audit_Date`. This report will tell you what we did, what we found, and what we suggest for your home. These suggestions include information on incentives and financing to make improvements more affordable.

------------------------------------------------------------------------

![](images/Logos-together.png)

## Table of Contents

Here will be the table of contents

## 1. Summary of your Audit

### 1.1 Visual Inspection and Measurements

We started with a tour and visual inspection of the inside and outside of the home. We identified any visible damage to the building, moisture control strategies, major appliances, and insulation. We measured square footage and volume of the home, as well as the area of all exterior windows and doors. We used a kill-a-watt meter to measure the electricity use of some appliances. During your audit, we used a carbon monoxide meter to measure the ambient carbon monoxide levels throughout the home.

### 1.2 Attic

We entered the attic to check for insulation, air sealing, ventilation, and potential hazards such as mold. Additionally, we visually inspected the attic ventilation and any duct and pipework passing through the attic.

### 1.3 Basement

We visually inspected any appliances in the basement and noted insulation levels, moisture, rodents, and any other concerns.

```{r}
#| label: If else chapter 1.4 heading
#| echo: false
#| eval: false
#| warning: false

x <- c("Heating oil")
if (x == "Heating oil") {
  cat('# 1.4 Combustion Appliance Safety1')
} else if (x == "Propane") {
  cat('# 1.4 Combustion Appliance Safety2')
} else if (x == "Kerosene") {
  cat('# 1.4 Combustion Appliance Safety3')
} else if (x == "Firewood"){
  cat('# 1.4 Combustion Appliance Safety4')
} else if (x == "Pellets") {
  cat('# 1.4 Combustion Appliance Safety5')
} else {
  cat("")
}
```

```{r}
#| label: If else text of chapter 1.4
#| echo: false
#| eval: false

x <- c("Heating oil")
if (x == "Heating oil") {
  writeLines("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens.")
} else if (x == "Propane") {
  cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens.")
} else if (x == "Kerosene") {
  cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens.")
} else if (x == "Firewood"){
  cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens.")
} else if (x == "Pellets") {
  cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens.")
} else {
  cat("")
}
```

### 1.4 Combustion Appliance Safety
We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens.

<!--- Option 1: We visually inspected and conducted combustion safety tests on the combustion appliance(s) in your home. This included measuring for carbon monoxide and testing that flue gases are properly exhausting from the home. 
Option 2: We visually inspected your appliance(s) but were unable to perform combustion safety tests.

IF propane gas, Add sentence to Options 1/2: We also performed gas leak detection tests on your propane appliance(s).--->

### 1.5 Blower Door / Air Leakage Test

We used a large fan in an exterior door to depressurize your house. This allows us to determine the volume of air leakage into the house and to locate bigger air leaks. To find leaks, we used an infrared camera to check for unusually hot and cold spots. We also checked the pressure differences of the rooms to help determine major air leak locations.

## 2. Summary of Recommendations

We recommend the following upgrades for your home. Detailed information about these recommendations and financial resources can be found in other sections of this report. 

```{r}
#| label: 2. summery table
#| eval: true
#| echo: false
gt_ranked_recommendations <- gt(ranked_clean_recommendations) |>
tab_options(table.width = pct(100))

gt_ranked_recommendations
```

## 3. What We Found
### 3.1 Basics 
```{r}
#| label: 3.1 basics table
#| eval: true
#| echo: false
gt_all_basics <- gt(all_basics) |>
tab_options(table.width = pct(100))

gt_all_basics
```
### 3.2 Exterior

### 3.3 Interior/Living space
### 3.4 Blower Door / Air Leakage Test
A blower door test simulates a 20mph wind hitting your house. To run the test, we used a large fan in an exterior door to depressurize your house. This allows us to determine the volume of air leakage into the house and to locate bigger air leaks. To find leaks, we used an infrared camera to check for unusually hot and cold spots. We also checked the pressure differences of the rooms to help determine major air leak locations.Air leaks are a big source of heat gain in warm weather and heat loss in cold weather. They also allow moisture to get into the home. Below are some numbers, pictures, and descriptions explaining what we found.
```{r}

```
Using a thermal imaging camera, we looked for major air leakage locations and thermal bridging, where heat is bypassesing the insulation.
There was evidence of …. 
### 3.5 Attic
### 3.6 Basement
### 3.7 Electrical and Mechanical Systems
### 3.8 Energy Bills
## 4. Recommendations
