---
title: "Energy Audit Report"
format:
  html: default
  pdf: default
  docx:
    number-sections: true
    number-depth: 3
    number-offset: 0
    mainfont: Calibri
    monofont: Calibri
css: styles.css
tbl-colwidths: [75,25]
editor: source
params:
  adress: "Me_test1"
  author: "Rudolfs"
---

```{r}
#| label: load packages
#| echo: false
#| warning: false

#Attach Packages
library(readr)
library(here)
library(dplyr)
library(ggplot2)
library(stringr)
library(readxl)
library(tidyverse)
library(gridExtra)
library(grid)
library(jpeg)
library(cowplot)
library(googlesheets4)
library(reticulate)
library(gt)
library(tibble)
library(kableExtra)
library(janitor)

```

```{r}
#| label: load googlesheets data
#| echo: false
#| warning: false
#| eval: true
#Load Audit Data
all_energy_test_googlesheets <- read_sheet("https://docs.google.com/spreadsheets/d/15TDUFfLuH6vbe5jwQaCYobvu17emCVfBTGN9KCwLEHk/edit?usp=sharing", col_types = "c")

energy_test_googlesheets <- all_energy_test_googlesheets[1, ]

clean_audit_data <- janitor::clean_names(energy_test_googlesheets)

#Load Recommendation Info
recommendations_googlesheets <- read_sheet("https://docs.google.com/spreadsheets/d/1Fyc65ybuRoQoYVWC3yNA_os7pPTD1vaKKcWS3ZRB7UU/edit?usp=sharing", col_types = "c", sheet = 1 )

#Load Conditional Recommendation Info
conditional_recommedations_googlesheets <- read_sheet("https://docs.google.com/spreadsheets/d/1Fyc65ybuRoQoYVWC3yNA_os7pPTD1vaKKcWS3ZRB7UU/edit?usp=sharing", col_types = "c", sheet = 2)

```


```{r}
#| label: setup rank recommendations data
#| echo: false
#| warning: false
#select only recomendations to make separate data frame
pivot_recommendations <- clean_audit_data |>
  select(c(recommendations_ranking_furnace_boiler_tune_up:recommendations_ranking_other_3, recommendations_ranking_ductwork_air_sealing_and_insulation, recommendations_ranking_misc_air_sealing_and_insulation, recommendations_ranking_replace_windows, recommendations_ranking_replace_doors))

#pivot teh data to be displayed vertically
pivot_recommendations <- pivot_recommendations |>
  pivot_longer(cols = everything(),
    names_to = "Rec_from_google_form", 
    values_to = "Rank")

ranked_clean_recommendations <- recommendations_googlesheets |>
  bind_cols(pivot_recommendations)|>
  select(-c(Rec_from_google_form))|>
  arrange(as.numeric(Rank))|>
  filter(Rank != 0)|>
  select(-Rank)

```

```{r}
#| label: Setup basics data
#| echo: false
#| warning: false
#| eval: true
#select only basic data that use numbers
energy_cost_quantity <- energy_test_googlesheets |>
  select(`Gallons of Heating Oil`,`Cost in Dollars (Heating Oil)`,`Gallons of Kerosene`,`Cost in Dollars (Kerosene)`,`Gallons of Propane`,`Cost in Dollars (Propane)`,`kWh of Electricity`,`Cost in Dollars (Electricity)`,`Cords of Firewood`,`Cost in Dollars (Firewood)`,`Tons of pellets`,`Cost in Dollars (Pellets)`,`Write the quantity and measuring unit`, `Cost in Dollars (Other)` )

  #select other data that is numbers
double_other <- clean_audit_data |>
  select( date_built, number_of_floors, volume_of_conditioned_space_cubic_feet, square_footage_of_conditioned_space, ambient_carbon_monoxide_reading)|>
  pivot_longer(cols = everything(),
    names_to = "Info", 
    values_to = "Values")|>
  mutate(Info = recode(Info, date_built = 'Date Built', number_of_floors = 'Number of floors', square_footage_of_conditioned_space = 'Square footage of conditioned space', volume_of_conditioned_space_cubic_feet = 'Volume of conditioned space (cubic feet)', ambient_carbon_monoxide_reading = 'Ambient Carbon Monoxide reading (ppm)'))


```

```{r}
#| label: attic data for basics
#| echo: false
  #select all the data that is basic related to attic
attic_basics <- energy_test_googlesheets |>
  select( `Attic insulation type`, `Quality of attic insulation's installation? Assess worst part of installation.`, `Thickness of the attic insulation (inches), at the thinnest location`)|>
  #join the data into one row
  mutate(Attic_all = paste(`Attic insulation type`, ",", `Thickness of the attic insulation (inches), at the thinnest location`, "inches"))|>
  mutate(Info = 'Attic',
        .before =`Attic insulation type`)

  #remove unwanted rows
attic_basics <- attic_basics[,-c(2,3,4)]
  
  #rename the column heading
names(attic_basics) <- c('Info', 'Values')
  

```

```{r}
#| label: setup energy sources gallons
#| echo: false

  #select amount and pivot the energy sources using gallons 
gallon_sources <- energy_cost_quantity |>
  select('Gallons of Heating Oil', 'Gallons of Propane', 'Gallons of Kerosene')|>
  pivot_longer(cols = c('Gallons of Heating Oil', 'Gallons of Propane', 'Gallons of Kerosene' ),
    names_to = "Source", 
    values_to = "Amount")

#select cost and pivot the energy sources using gallons 
gallon_cost <- energy_cost_quantity|>
  select('Cost in Dollars (Heating Oil)', 'Cost in Dollars (Propane)', 'Cost in Dollars (Kerosene)')|>
  pivot_longer(cols = c('Cost in Dollars (Heating Oil)', 'Cost in Dollars (Propane)', 'Cost in Dollars (Kerosene)'),
    names_to = "Source_Cost", 
    values_to = "Dollars")

  #filter sources that are not present in the house 
annual_totals_gallon <- gallon_sources |>
  cbind(gallon_cost) |>
  filter(Amount != is.na(NA))|>
  mutate(Anual_Totals = paste0(`Amount`, " Gallons,", `Dollars`, "USD"))

annual_totals_gallon <- annual_totals_gallon |>
  mutate(Source = recode(Source,  'Gallons of Heating Oil' = 'Annual heating oil usage from bills:', 'Gallons of Propane' = 'Annual propane usage from bills:', 'Gallons of Kerosene' = 'Annual kerosene usage from the bills:'))

annual_totals_gallon <- annual_totals_gallon[, -c(2,3,4)]
```

```{r}
#| label: setup energy sources kWh
#| echo: false
kWh_sources <- energy_cost_quantity |>
  select('kWh of Electricity')|>
  pivot_longer(cols = c('kWh of Electricity'),
    names_to = "Source", 
    values_to = "Amount")

kWh_cost <- energy_cost_quantity|>
  select('kWh of Electricity')|>
  pivot_longer(cols = c('kWh of Electricity'),
    names_to = "Source_Cost", 
    values_to = "Dollars")

annual_totals_kWh <- kWh_sources |>
  cbind(gallon_cost) |>
  filter(Amount != is.na(NA))|>
  mutate(Anual_Totals = paste(`Amount`, " kWh,", `Dollars`, "USD"))|>
  mutate(Source = recode(Source,  'kWh of Electricity' = 'Annual electricity usage from bills:',))

annual_totals_kWh <- annual_totals_kWh[, -c(2,3,4)]
```

```{r}
#| label: setup energy sources cords
#| echo: false
cords_sources <- energy_cost_quantity |>
  select('Cords of Firewood')|>
  pivot_longer(cols = c('Cords of Firewood'),
    names_to = "Source", 
    values_to = "Amount")

cords_cost <- energy_cost_quantity|>
  select('Cords of Firewood')|>
  pivot_longer(cols = c('Cords of Firewood'),
    names_to = "Source_Cost", 
    values_to = "Dollars")

annual_totals_cords <- cords_sources |>
  cbind(cords_cost) |>
  filter(Amount != is.na(NA))|>
  mutate(Anual_Totals = paste(`Amount`, " Cords,", `Dollars`, "USD"))|>
   mutate(Source = recode(Source, 'Cords of Firewood' = 'Annual firewood usage from bills:',))

annual_totals_cords <- annual_totals_cords[, -c(2,3,4)]
```

```{r}
#| label: setup energy sources tons
#| echo: false
tons_sources <- energy_cost_quantity |>
  select('Tons of pellets')|>
  pivot_longer(cols = c('Tons of pellets'),
    names_to = "Source", 
    values_to = "Amount")

tons_cost <- energy_cost_quantity|>
  select('Tons of pellets')|>
  pivot_longer(cols = c('Tons of pellets'),
    names_to = "Source_Cost", 
    values_to = "Dollars")

annual_totals_tons <- tons_sources |>
  cbind(tons_cost) |>
  filter(Amount != is.na(NA))|>
  mutate(Anual_Totals = paste(`Amount`, " Tons,", `Dollars`, "USD"))|>
   mutate(Source = recode(Source,  'Tons of pellets' = 'Annual pellets usage from bills:',))

annual_totals_tons <- annual_totals_tons[, -c(2,3,4)]
```

```{r}
#| label: setup energy sources other
#| echo: false
other_sources <- energy_cost_quantity |>
  select('Write the quantity and measuring unit')|>
  pivot_longer(cols = c('Write the quantity and measuring unit'),
    names_to = "Source", 
    values_to = "Amount")

other_cost <- energy_cost_quantity|>
  select('Write the quantity and measuring unit')|>
  pivot_longer(cols = c('Write the quantity and measuring unit'),
    names_to = "Source_Cost", 
    values_to = "Dollars")

annual_totals_other <- other_sources |>
  cbind(other_cost) |>
  filter(Amount != is.na(NA))|>
  mutate(Anual_Totals = paste(`Amount`, `Dollars`, "USD"))|>
  mutate(Source = recode(Source,  'Write the quantity and measuring unit' = 'Other annual energy usage from bills:',))

annual_totals_other <- annual_totals_other[, -c(2,3,4)]
```

```{r}
#| label: annual totals for energy sources chapter 3
#| echo: false
annual_totals <- annual_totals_kWh|>
  rbind(annual_totals_gallon, annual_totals_cords, annual_totals_tons )

names(annual_totals) <- c('Info', 'Values')
```

```{r}
#| label: all basics
#| echo: false

all_basics <- double_other |>
  rbind(attic_basics,annual_totals )|> #character_other,
  arrange(factor(Info, levels = c('Date Built', 'Foundation Type', 'Attic', 'Number of floors', 'Square footage of conditioned space', 'Volume of conditioned space (cubic feet)','Ambient Carbon Monoxide reading')))
```

```{r}
#| label: setup interior/living spaces for 3.3
#| echo: false

all_interior <- clean_audit_data|>
  
  #select all the columns that have information about the interior/living spaces
  select(wall_stud_insulation_type, thickness_of_the_wall_stud_insulation, quality_of_wall_stud_insulations_installation_assess_worst_part_of_installation, any_additional_comments_on_wall_stud_insulation, wall_continuous_insulation_type, thickness_of_the_wall_continuous_insulation, quality_of_wall_continuous_insulations_installation_assess_worst_part_of_installation, any_additional_comments_on_wall_continuous_insulation, framing_type, general_comment_about_the_living_room, general_comment_about_the_bathroom_s, general_comment_about_the_kitchen, k_wh_reading_1, k_wh_reading_2, time_passed_since_installation_of_kilowatt_meter_1, time_passed_since_installation_of_kilowatt_meter_2, which_appliance_did_you_measure_1, which_appliance_did_you_measure_2)|>
  
  #make conditional stock framing description
mutate(stock_framing = case_when( framing_type == "Balloon" ~ 'The framing type of the home is balloon framing, which means the wall cavities extend the full height of the building (from the foundation to the roof). Often the wall cavities are interconnected with the floor and ceiling cavities. This framing type can create connected passageways for air to leave the house and rodents to enter the house. ', framing_type == "Platform" ~ 'The framing type of the home is platform framing, which means that wall cavities do not extend the full height of the building and are instead separated by floors. ', TRUE ~ 'NA'))|>

 #join information into one column for stud insulation in 3.3
  mutate('Walls:'= paste0( stock_framing, "There is ", wall_stud_insulation_type, " insulation ", thickness_of_the_wall_stud_insulation, " inches thick in ", quality_of_wall_stud_insulations_installation_assess_worst_part_of_installation, " condition. ", any_additional_comments_on_wall_stud_insulation))|>
   

  
  #join information into one column for kitchen in 3.3
  mutate('Kitchen:'= paste0(which_appliance_did_you_measure_1, " used ", k_wh_reading_1, " kWh in ", time_passed_since_installation_of_kilowatt_meter_1, " minutes. ", which_appliance_did_you_measure_2, " used ", k_wh_reading_2, " kWh in ", time_passed_since_installation_of_kilowatt_meter_2, " minutes. ", general_comment_about_the_kitchen ))|>
  
  #delete unwanted columns, the once that were used to create joined columns
  select(-c(1:9, 12:19))|>
  
  #pivot horizontal columns to be displayed vertical in the rows
  pivot_longer(cols = everything() ,
    names_to = "Info" ,
    values_to = "Values")|>
  
  #rename the columns as they need to be displayed
  mutate(Info = recode(Info,  general_comment_about_the_living_room = 'Living room:', general_comment_about_the_bathroom_s = 'Bathroom(s):'))|>
  
  #arrange the rows in wanted order
  arrange(factor(Info, levels = c('Walls:')))
```

```{r}
#| label: setup exterior doors
#| echo: false
#| eval: true


exterior_doors <-clean_audit_data|>
  select(door_s_type_1, door_s_type_2, door_s_type_3, door_s_material_1, door_s_material_2, door_s_material_3, number_of_doors_of_this_type_1, number_of_doors_of_this_type_2, number_of_doors_of_this_type_3, total_door_area_of_this_type_1, total_door_area_of_this_type_2, total_door_area_of_this_type_3, condition_fit_of_the_doors_of_this_type_1, condition_fit_of_the_doors_of_this_type_2, condition_fit_of_the_doors_of_this_type_3)



exterior_doors <- exterior_doors|>
  mutate_all(~replace(., is.na(.), 0))

exterior_doors <- if (exterior_doors$number_of_doors_of_this_type_3 >= 1) {
  mutate(exterior_doors, Values = paste0("There are ", number_of_doors_of_this_type_1, " ",door_s_type_1," ", door_s_material_1, " exterior doors. In ", condition_fit_of_the_doors_of_this_type_1, " condition, totaling ", total_door_area_of_this_type_1, " square feet.", "Furthermore there are ",number_of_doors_of_this_type_2, " ",door_s_type_2," ", door_s_material_2, " exterior doors. In ", condition_fit_of_the_doors_of_this_type_2, " condition, totaling ", total_door_area_of_this_type_2, " square feet. Moreover there are ", number_of_doors_of_this_type_1, " ",door_s_type_1," ", door_s_material_1, " exterior doors. In ", condition_fit_of_the_doors_of_this_type_1, " condition, totaling ", total_door_area_of_this_type_1, " square feet."))
} else if (exterior_doors$number_of_doors_of_this_type_2 >= 1) {
  mutate(exterior_doors, Values = paste0("There are ",number_of_doors_of_this_type_2, " ",door_s_type_2," ", door_s_material_2, " exterior doors. In ", condition_fit_of_the_doors_of_this_type_2, " condition, totaling ", total_door_area_of_this_type_2, " square feet. Moreover there are ", number_of_doors_of_this_type_1, " ",door_s_type_1," ", door_s_material_1, " exterior doors. In ", condition_fit_of_the_doors_of_this_type_1, " condition, totaling ", total_door_area_of_this_type_1, " square feet."))
} else if (exterior_doors$number_of_doors_of_this_type_1 >= 1) {
  mutate(exterior_doors, Values = paste0("There are ",number_of_doors_of_this_type_1, " ",door_s_type_1," ", door_s_material_1, " exterior doors. In ", condition_fit_of_the_doors_of_this_type_1, " condition, totaling ", total_door_area_of_this_type_1, " square feet."))
} else {
  mutate(exterior_doors, Values = paste0("There are no exterior doors"))
}

exterior_doors <- exterior_doors|>
  select(-c(1:15))

exterior_doors <- exterior_doors|>
  pivot_longer(cols = Values ,
    names_to = "Info" ,
    values_to = "Values")|>
  mutate(Info = recode(Info,  'Values' = 'Exterior doors:',))
```

```{r}
#| label: windows setup
#| echo: false
#| eval: true


exterior_windows <-clean_audit_data|>
  select(how_many_windows_of_this_type_there_are_1, how_many_windows_of_this_type_there_are_2, how_many_windows_of_this_type_there_are_3, how_many_windows_of_this_type_there_are_4, how_many_windows_of_this_type_there_are_5, number_of_panes_1, number_of_panes_2, number_of_panes_3, number_of_panes_4, number_of_panes_5, material_of_the_windows_1, material_of_the_windows_2, material_of_the_windows_3, material_of_the_windows_4, material_of_the_windows_5, condition_of_the_windows_of_this_type_1, condition_of_the_windows_this_type_2, condition_of_the_windows_this_type_3, condition_of_the_windows_this_type_4, condition_of_the_windows_this_type_5, total_windows_areas_of_this_type_1, total_windows_areas_of_this_type_2, total_windows_areas_of_this_type_3, total_windows_areas_of_this_type_4, total_windows_areas_of_this_type_5)

exterior_windows <- exterior_windows|>
  mutate_all(~replace(., is.na(.), 0))

exterior_windows <- if (exterior_windows$how_many_windows_of_this_type_there_are_5 >= 1) {
  mutate(exterior_windows, Values = paste0("There are ", how_many_windows_of_this_type_there_are_1 , " ", number_of_panes_1 ," paned ", material_of_the_windows_1, " windows. In ", condition_of_the_windows_of_this_type_1, " condition, totaling ", total_windows_areas_of_this_type_1, " square feet. Moreover there are ", how_many_windows_of_this_type_there_are_2, " ", number_of_panes_2, " paned ", material_of_the_windows_2, " windows. In ", condition_of_the_windows_this_type_2, " condition, totaling ", total_windows_areas_of_this_type_2, " square feet. Furthermore there are " , how_many_windows_of_this_type_there_are_3, " ", number_of_panes_3, " paned ", material_of_the_windows_3, " windows. In ", condition_of_the_windows_this_type_3, " condition, totaling ", total_windows_areas_of_this_type_3, " square feet. Also there are ", , how_many_windows_of_this_type_there_are_4, " ", number_of_panes_4, " paned ", material_of_the_windows_4, " windows. In ", condition_of_the_windows_this_type_4, " condition, totaling ", total_windows_areas_of_this_type_4, " square feet. At last there are " , how_many_windows_of_this_type_there_are_5, " ", number_of_panes_5, " paned ", material_of_the_windows_5, " windows. In ", condition_of_the_windows_this_type_5, " condition, totaling ", total_windows_areas_of_this_type_5, " square feet."))
} else if (exterior_windows$how_many_windows_of_this_type_there_are_4 >= 1) {
  mutate(exterior_windows, Values = paste0("There are ", how_many_windows_of_this_type_there_are_1 , " ", number_of_panes_1 ," paned ", material_of_the_windows_1, " windows. In ", condition_of_the_windows_of_this_type_1, " condition, totaling ", total_windows_areas_of_this_type_1, " square feet. Moreover there are ", how_many_windows_of_this_type_there_are_2, " ", number_of_panes_2, " paned ", material_of_the_windows_2, " windows. In ", condition_of_the_windows_this_type_2, " condition, totaling ", total_windows_areas_of_this_type_2, " square feet. Furthermore there are " , how_many_windows_of_this_type_there_are_3, " ", number_of_panes_3, " paned ", material_of_the_windows_3, " windows. In ", condition_of_the_windows_this_type_3, " condition, totaling ", total_windows_areas_of_this_type_3, " square feet. Also there are ", , how_many_windows_of_this_type_there_are_4, " ", number_of_panes_4, " paned ", material_of_the_windows_4, " windows. In ", condition_of_the_windows_this_type_4, " condition, totaling ", total_windows_areas_of_this_type_4, " square feet."))
} else if (exterior_windows$how_many_windows_of_this_type_there_are_3 >= 1) {
  mutate(exterior_windows, Values = paste0("There are ", how_many_windows_of_this_type_there_are_1 , " ", number_of_panes_1 ," paned ", material_of_the_windows_1, " windows. In ", condition_of_the_windows_of_this_type_1, " condition, totaling ", total_windows_areas_of_this_type_1, " square feet. Moreover there are ", how_many_windows_of_this_type_there_are_2, " ", number_of_panes_2, " paned ", material_of_the_windows_2, " windows. In ", condition_of_the_windows_this_type_2, " condition, totaling ", total_windows_areas_of_this_type_2, " square feet. Furthermore there are " , how_many_windows_of_this_type_there_are_3, " ", number_of_panes_3, " paned ", material_of_the_windows_3, " windows. In ", condition_of_the_windows_this_type_3, " condition, totaling ", total_windows_areas_of_this_type_3, " square feet."))
} else if (exterior_windows$how_many_windows_of_this_type_there_are_2 >= 1) {
  mutate(exterior_windows, Values = paste0("There are ", how_many_windows_of_this_type_there_are_1 , " ", number_of_panes_1 ," paned ", material_of_the_windows_1, " windows. In ", condition_of_the_windows_of_this_type_1, " condition, totaling ", total_windows_areas_of_this_type_1, " square feet. Moreover there are ", how_many_windows_of_this_type_there_are_2, " ", number_of_panes_2, " paned ", material_of_the_windows_2, " windows. In ", condition_of_the_windows_this_type_2, " condition, totaling ", total_windows_areas_of_this_type_2, " square feet."))
} else if (exterior_windows$how_many_windows_of_this_type_there_are_1 >= 1) {
  mutate(exterior_windows, Values = paste0("There are ", how_many_windows_of_this_type_there_are_1 , " ", number_of_panes_1 ," paned ", material_of_the_windows_1, " windows. In ", condition_of_the_windows_of_this_type_1, " condition, totaling ", total_windows_areas_of_this_type_1, " square feet."))
} else {
  mutate(exterior_windows, Values = paste0("There are no exterior windows"))
}

exterior_windows <- exterior_windows|>
  select(-c(1:25))

exterior_windows <- exterior_windows|>
  pivot_longer(cols = Values ,
    names_to = "Info" ,
    values_to = "Values")|>
  mutate(Info = recode(Info,  'Values' = 'Exterior windows:',))
```



```{r}
#| label: 3.4 data set up old 
#| echo: false
#| eval: false
blower_door_leakage <- energy_test_googlesheets|>
  select( "Equivalent leakage area")|>
  mutate(`Equivalent leakage area` = paste0(`Equivalent leakage area`, " under natural conditions."))

#blower_door_leakage <-blower_door_leakage[,-c(1)]

blower_door_leakage <-blower_door_leakage|>
  pivot_longer(c("Equivalent leakage area"),
    names_to = "Info", 
    values_to = "Values")

blower_door <- energy_test_googlesheets|>
  select(c("CFM50", "ACH50","ACHn", ))|> #there is another column "Comments about air leakage"
  pivot_longer(c("CFM50", "ACH50","ACHn"),
    names_to = "Info", 
    values_to = "Values")

all_blower_door <- blower_door|>
  rbind(blower_door_leakage)|>
  mutate(Info = recode(Info,  "CFM50" = "CFM50:", "ACH50" = "ACH50:","Equivalent leakage area" = "Equivalent leakage area:","ACHn" = "ACHnatural:" ))|>
  arrange(factor(Info, levels = c('CFM50:', 'ACH50:', 'Equivalent leakage area:', 'ACHnatural:')))

all_blower_door['Description'] <- c("CFM50 describes how many cubic feet per minute of air are leaving the house at 50 pascals of pressure difference (while the blower door is running). For every cubic foot of air that leaves the house, a cubic foot of air enters the house as well. The higher the number, the leakier the house.", "ACH50 tells us how many air changes per hour are taking place in the house at 50 pascals of pressure difference. This value is normalized for the volume of the house and thus allows for comparison between different houses. The higher the number, the leakier the house.","This is the area (in square inches) equivalent to all of the air leaks in the house combined.","Accounting for the volume of the home, this means that the house exchanges –% of its air every hour. Over one day, the house goes through – complete air changes.")
```


```{r}
#| label: attic data for 3.5
#| echo: false

attic_double <- energy_test_googlesheets|>
  select(`Attic Area`)|> # `Thickness of the attic insulation (inches), at the thinnest location`
  pivot_longer(c(`Attic Area`),
    names_to = "Info",
    values_to = "Values")

attic_character <- energy_test_googlesheets|>
  select(`Does attic have air sealing?`, `Comment about air sealing`, `Any additional comments on attic insulation, e.g., is the entire attic insulated?`, `Any hazards or mold/moisture/asbestos present in the attic?`, `Describe the hazards or mold/moisture in the attic`, `Is there ductwork in the attic?`, `Comment about condition of the ductwork in the attic`,`Are bathroom and kitchen exhaust fans being vented to outside?`,`Attic ventilation type?`, `Quality of attic insulation's installation? Assess worst part of installation.`,`Attic insulation type`)|>
  mutate(`Air sealing:` = paste0("There is ",`Does attic have air sealing?`,"air sealing. ",`Comment about air sealing`))|>
  mutate(`Other observations:` = paste(`Any additional comments on attic insulation, e.g., is the entire attic insulated?`, `Any hazards or mold/moisture/asbestos present in the attic?`, `Describe the hazards or mold/moisture in the attic`))|>
  mutate(`Ventilation:` = `Are bathroom and kitchen exhaust fans being vented to outside?`,`Attic ventilation type?`)|>
  mutate(`Ducts:` = `Is there ductwork in the attic?`, `Comment about condition of the ductwork in the attic`)

attic_character <- attic_character[, -c(1:9)]
  
attic_character <- attic_character|>
  pivot_longer(cols = everything(),
  names_to = "Info",
   values_to = "Values")

all_attic <- attic_double|>
  rbind(attic_character)|>
  arrange((factor(Info, levels = c("Attic Area","Attic insulation type", "Quality of attic insulation's installation? Assess worst part of installation.", "Air sealing:","Other observations:","Ventilation:","Ducts:" ))))|>
  mutate(Info = recode(Info,"Attic Area" = "Area (sq ft):","Attic insulation type" = "Insulation type:", "Quality of attic insulation's installation? Assess worst part of installation." = "Insulation condition:"  ))#|>
  #filter(str_detect(Values, pattern = "No"))
```

```{r}
#| label: basement data for 3.6
#| echo: false

all_basement <- clean_audit_data|>
  
  #select all the columns that have information about the basement/crawlspace
  select(is_there_ductwork_in_the_basement_crawlspace, comment_about_ductwork_condition_in_the_basement_crawlspace, comment_about_the_basement_crawlspace_insulation, hazards_basement_crawlspace, any_hazards_or_mold_moisture_asbestos_present_in_the_basement_crawlspace, describe_the_hazards_or_mold_moisture_in_basement_crawlspace, quality_of_the_basement_crawlspace_insulations_installation_assess_worst_part_of_installation, moisture_and_mold_control_strategies, basement_crawlspace_insulation_type, insulation_of_appliances_in_basement_crawlspace, area_of_basement_crawlspace_ground_square_feet, thickness_of_basement_crawlspace_insulation, basement_crawlspace_net_wall_area, condition_of_moisture_control_strategies_in_the_basement_crawlspace, comments_about_existing_moisture_control_strategies )|>
  
  #join information into one column for moisture control in 3.6
  mutate(`Moisture Control:` = paste0(moisture_and_mold_control_strategies, "in ",condition_of_moisture_control_strategies_in_the_basement_crawlspace,"condition. ", comments_about_existing_moisture_control_strategies))|>
  
  #join information into one column for ducts in 3.6
  mutate(`Ducts:` = paste0(is_there_ductwork_in_the_basement_crawlspace,comment_about_ductwork_condition_in_the_basement_crawlspace))|>
  
  #join information into one column for insulation condition in 3.6
  mutate(`Insulation condition:` = paste0(quality_of_the_basement_crawlspace_insulations_installation_assess_worst_part_of_installation, comment_about_the_basement_crawlspace_insulation))|>
  
  #join information into one column for other observations in 3.6
  mutate(`Other observations:` = paste0("There is ", hazards_basement_crawlspace, describe_the_hazards_or_mold_moisture_in_basement_crawlspace))|>
  
  #delete unwanted columns, the once that were used to create joined columns
  select(-c(1:8, 12:15))|>
  
  #pivot horizontal columns to be displayed vertical in the rows
  pivot_longer(, cols = everything(),
    names_to = "Info",
    values_to = "Values")|>
  
  #rename the columns as they need to be displayed
  mutate(Info = recode(Info,  area_of_basement_crawlspace_ground_square_feet = 'Area (sq ft):', insulation_of_appliances_in_basement_crawlspace = 'Insulation of appliances:', 	
basement_crawlspace_insulation_type = 'Inuslation type:'))|>
  
  #arrange the rows in correct order
  arrange(factor(Info, levels = c('Area (sq ft):','Inuslation type:', 'Insulation condition:')))

```

```{r}
#| label: house image path setup
#| echo: false
#| warning: false

# Unique identifier for the image
image_id <- "House_photo_placeholder"

# Generate the file path for the image based on the identifier
image_path <- paste0("", image_id, ".png")


```

```{r, out.width = "50%", fig.align = 'center'}
#| label: image render
#| echo: false
#| warning: false
#| eval: false

# Include the image in the report
knitr::include_graphics(image_path,)
```

Homeowner(s): `r clean_audit_data$homeowner_s`

Address: `r clean_audit_data$home_address`

Auditors: `r clean_audit_data$names_of_the_auditors`

Contact: mdicommunityenergy\@coa.edu, (802) 266-0301

Date: `r format(Sys.time(), '%B %e %Y')`

------------------------------------------------------------------------

We conducted an energy assessment of your home on `r clean_audit_data$date_of_audit`. This report will tell you what we did, what we found, and what we suggest for your home. These suggestions include information on incentives and financing to make improvements more affordable.

------------------------------------------------------------------------

![](images/Logos-together.png)

**Add here the table of content: in Word go to references and add table of content, in Docs go to the insert and on the bottom add the table of context**

## Summary of your Audit

### Visual Inspection and Measurements

We started with a tour and visual inspection of the inside and outside of the home. We identified any visible damage to the building, moisture control strategies, major appliances, and insulation. We measured square footage and volume of the home, as well as the area of all exterior windows and doors. We used a kill-a-watt meter to measure the electricity use of some appliances. During your audit, we used a carbon monoxide meter to measure the ambient carbon monoxide levels throughout the home.

### Attic

We entered the attic to check for insulation, air sealing, ventilation, and potential hazards such as mold. Additionally, we visually inspected the attic ventilation and any duct and pipework passing through the attic.

### Basement

We visually inspected any appliances in the basement and noted insulation levels, moisture, rodents, and any other concerns.

### Blower Door / Air Leakage Test

A blower door test measures the air tightness of a building. We used a specialized fan in an exterior door to generate negative pressure inside your house. The resulting pressure difference between the inside and outside of the house allows us to measure air leakage. To locate the leaks, we used an infrared camera to check for unusually hot and cold spots. We also checked the pressure differences of the rooms to help determine major air leak locations.

```{r}
#| label: data setup for 1.5 chapter
#| echo: false
#| eval: true
#| warning: false

chapter_1.5_header <- clean_audit_data |>
  mutate(combustion_fuels = str_detect(energy_sources, pattern = "[Hh]eat|Kerosene|Propane|Firewood|Pellets|Other"))

energy_sources_googlesheets <- clean_audit_data |>
  mutate(combustion_propane = str_detect(energy_sources, pattern = "Propane"))

clean_audit_data <- clean_audit_data|>
  mutate(combustionst1 = str_detect(could_you_perform_combustion_safety_tests_in_worst_case_scenario_1, pattern = "Yes")) |>

#I will have to add this later
##|>
 ## mutate(combustionst2 = str_detect(could_you_perform_combustion_safety_tests_in_worst_case_scenario_2, ##pattern = "Yes"))|>
 ## mutate(combustionst3 = str_detect(could_you_perform_combustion_safety_tests_in_worst_case_scenario_3, pattern = "Yes"))

  mutate(could_you_perform_combustion_safety_tests_in_worst_case_scenario_1 = ifelse(is.na(could_you_perform_combustion_safety_tests_in_worst_case_scenario_1), 0, could_you_perform_combustion_safety_tests_in_worst_case_scenario_1))|>
  mutate(combustionst1 = str_detect(could_you_perform_combustion_safety_tests_in_worst_case_scenario_1, pattern = "Yes"))|>
  mutate(combustionst2 = str_detect(could_you_perform_combustion_safety_tests_in_worst_case_scenario_2, pattern = "Yes"))|>
  mutate(combustionst3 = str_detect(could_you_perform_combustion_safety_tests_in_worst_case_scenario_3, pattern = "Yes"))

  
```

```{r}
#| label: header chapter 1.5
#| echo: false
#| results: asis

if (chapter_1.5_header$combustion_fuels == TRUE) {
cat("### Combustion Appliance Safety")
} else {
cat(" ")
}
```

```{r}
#| label: text in 1.5 chapter
#| echo: false
#| warning: false
#| results: asis


if (clean_audit_data$combustionst1 == TRUE) {
  cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, as well as conducted combustion safety tests. This included measuring for carbon monoxide and testing that flue gases are properly exhausting from the home.")
}  else if (clean_audit_data$combustionst1 == FALSE) {
  cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, but we were unable to perform combustion safety tests.")
} else {
  cat("")
}
if(energy_sources_googlesheets$combustion_propane == TRUE){
  cat(" We also performed gas leak detection tests on your propane appliance(s).")
}else{
  cat("")
}

#else if (clean_audit_data$combustionst2 == TRUE) {
  #cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, as well as conducted combustion safety tests. This included measuring for carbon monoxide and testing that flue gases are properly exhausting from the home.")
#}  else if (clean_audit_data$combustionst3 == TRUE) {
 # cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, as well as conducted combustion safety tests. This included measuring for carbon monoxide and testing that flue gases are properly exhausting from the home.")
#}  else if #(clean_audit_data$combustionst4 == TRUE) {
  #cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, as well as conducted combustion safety tests. This included measuring for carbon monoxide and testing that flue gases are properly exhausting from the home.")
#} else if (clean_audit_data$combustionst1 == FALSE) {
 # cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, but we were unable to perform combustion safety tests.")
#}  else if (clean_audit_data$combustionst2 == FALSE) {
 # cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, but we were unable to perform combustion safety tests.")
#}  else if (clean_audit_data$combustionst3 == FALSE) {
 # cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, but we were unable to perform combustion safety tests.")
#}  else if (clean_audit_data$combustionst4 == FALSE) {
 # cat("We assessed combustion appliances that burn fossil fuels such as propane, heating oil, or kerosene. These include furnaces, boilers, water heaters, and gas ovens. We visually inspected the combustion appliance(s) in your home, but we were unable to perform combustion safety tests.")
```

```{r}
#| label: gas option in 1.5 chapter
#| echo: false
#| results: asis
#| eval: false

if(energy_sources_googlesheets$combustion_propane == TRUE){
  cat("We also performed gas leak detection tests on your propane appliance(s).")
}else{
  cat("")
  }
```

## Summary of Recommendations

We recommend the following upgrades for your home. Detailed information about these recommendations and financial resources can be found in other sections of this report. These are organized from the least expensive/most cost-effective and easiest interventions to ones that are more challenging to implement.

```{r}
#| label: 2. summery table
#| eval: true
#| echo: false
gt_ranked_recommendations <- gt(ranked_clean_recommendations) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Recommendations ~ px(200),
    Description ~ px(450)
  )

gt_ranked_recommendations
```

## What We Found

### Basics

```{r}
#| label: 3.1 basics table
#| eval: true
#| echo: false
gt_all_basics <- gt(all_basics) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Info ~ px(200),
    Values ~ px(450)
  )|>
  tab_options(column_labels.hidden = TRUE)
  #cols_label(
  #  Info = "",
 #   Values = ""
 # )
  

gt_all_basics
```

### Exterior

```{r}
#| label: setup exterior data 3.2
#| echo: false

exterior_3.2 <- clean_audit_data|>
  select(roof_type, roof_age, condition_of_the_roof, orientation_of_the_primary_roof_faces, comment_about_condition_of_the_roof, existing_moisture_control_strategies, condition_of_moisture_control_strategies, comments_about_existing_moisture_control_strategies,siding_type, comment_about_condition_of_the_siding, condition_of_the_siding)|>
  
  #remove values with N/A
  #mutate(select() str_detect(`Energy Sources`, pattern = #"[Hh]eat|Kerosene|Propane|Firewood|Pellets|Other"))
  
  #join information into one column for roof type in 3.2
  mutate('Roof type:'= paste0(roof_type, "in ",  condition_of_the_roof ,"condition. ", comment_about_condition_of_the_roof))|>
  
  #join information into one column for moisture control in 3.2
  mutate('Moisture control:' = paste0("Current moisture control strategies: ", existing_moisture_control_strategies,'.  These were in ',condition_of_moisture_control_strategies, ' condition .',comments_about_existing_moisture_control_strategies))|>
  
  #join information into one column for siding in 3.2
  mutate('Siding:' = paste0(siding_type,' in ', condition_of_the_siding, ' condition. ', comment_about_condition_of_the_siding))|>
  
  #delete unwanted columns, the once that were used to create joined columns
  select(-c(1,3,5:11))|>
  
  #pivot horizontal columns to be displayed vertical in the rows
  pivot_longer(cols = everything() ,
    names_to = "Info" ,
    values_to = "Values")|>
  
  #rename the columns as they need to be displayed
  mutate(Info = recode(Info,  roof_age = 'Roof age:', orientation_of_the_primary_roof_faces = 'Orientation:'))|>
  
  #bind rows with the exterior doors and windows
  rbind(exterior_doors, exterior_windows)

  

```

```{r}
#| label: 3.2 Exterior table
#| eval: true
#| echo: false
gt_exterior_3.2 <- gt(exterior_3.2) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Info ~ px(200),
    Values ~ px(450)
  )|>
  tab_options(column_labels.hidden = TRUE)#|>
  #tab_style(
    #style = cell_borders(
     # sides = "all",
     # color = "blue",
     # weight = px(3)
   # ),
   # locations = list(cells_column_labels())
 # )

gt_exterior_3.2

```

### Interior/Living space

```{r}
#| label: 3.3 interior
#| eval: true
#| echo: false
gt_all_interior <- gt(all_interior) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Info ~ px(150),
    Values ~ px(100)
  )|>
  tab_options(column_labels.hidden = TRUE)

gt_all_interior
```

### Blower Door / Air Leakage Test

```{r}
#| label: blower door data set up for 3.4
#| echo: false

#old set up wiht manual entry to googlespreadsheet
blower_door_leakage <- energy_test_googlesheets|>
  select( "Equivalent leakage area")|>
  mutate(`Equivalent leakage area` = paste0(`Equivalent leakage area`, " under natural conditions."))

#blower_door_leakage <-blower_door_leakage[,-c(1)]

blower_door_leakage <-blower_door_leakage|>
  pivot_longer(c("Equivalent leakage area"),
    names_to = "Info", 
    values_to = "Values")

blower_door <- energy_test_googlesheets|>
  select(c("CFM50", "ACH50","ACHn", ))|> #there is another column "Comments about air leakage"
  pivot_longer(c("CFM50", "ACH50","ACHn"),
    names_to = "Info", 
    values_to = "Values")

all_blower_door <- blower_door|>
  rbind(blower_door_leakage)|>
  mutate(Info = recode(Info,  "CFM50" = "CFM50:", "ACH50" = "ACH50:","Equivalent leakage area" = "Equivalent leakage area:","ACHn" = "ACHnatural:" ))|>
  arrange(factor(Info, levels = c('CFM50:', 'ACH50:', 'Equivalent leakage area:', 'ACHnatural:')))

all_blower_door['Description'] <- c("CFM50 describes how many cubic feet per minute of air are leaving the house at 50 pascals of pressure difference (while the blower door is running). For every cubic foot of air that leaves the house, a cubic foot of air enters the house as well. The higher the number, the leakier the house.", "ACH50 tells us how many air changes per hour are taking place in the house at 50 pascals of pressure difference. This value is normalized for the volume of the house and thus allows for comparison between different houses. The higher the number, the leakier the house.","This is the area (in square inches) equivalent to all of the air leaks in the house combined.","Accounting for the volume of the home, this means that the house exchanges –% of its air every hour. Over one day, the house goes through – complete air changes.")


```

```{r}
#| label: ACH/CFM/ELA/N-factor calculations
#| echo: false

table_3_4 <-clean_audit_data|>
  select(cfm50)

table_3_4<- as.data.frame(as.numeric(table_3_4))

#ACH50 calculation

table_3_4$ACH50_cal <- as.numeric(clean_audit_data$cfm50) * 60 / as.numeric(clean_audit_data$volume_of_conditioned_space_cubic_feet)

#Equivalent leakage area calculation

table_3_4$equi_leak_area_cal <- (as.numeric(clean_audit_data$cfm50) / 10)

#N-factor calculation

n_factor_calculated <- clean_audit_data |>
  select(exposure_of_the_house, number_of_floors)|>
  mutate(n_factor_cal = case_when(
    exposure_of_the_house == "Low" & number_of_floors == 1 ~ 22.2,
    exposure_of_the_house == "Low" & number_of_floors == 1.5 ~ 20.0,
    exposure_of_the_house == "Low" & number_of_floors == 2 ~ 17.8,
    exposure_of_the_house == "Low" & number_of_floors == 3 ~ 15.5,
    exposure_of_the_house == "Moderate" & number_of_floors == 1 ~ 18.5,
    exposure_of_the_house == "Moderate" & number_of_floors == 1.5 ~ 16.7,
    exposure_of_the_house == "Moderate" & number_of_floors == 2 ~ 14.8,
    exposure_of_the_house == "Moderate" & number_of_floors == 3 ~ 13.0,
    exposure_of_the_house == "High" & number_of_floors == 1 ~ 16.7,
    exposure_of_the_house == "High" & number_of_floors == 1.5 ~ 15.0,
    exposure_of_the_house == "High" & number_of_floors == 2 ~ 13.3,
    exposure_of_the_house == "High" & number_of_floors == 3 ~ 11.7))
  


#CFM natural calculation (Do I need to even calculate it)

#table_3_4$CFMnatural_cal <- as.numeric(n_factor_calculated$n_factor_cal)/ as.numeric(clean_audit_data$cfm50)


#ACH natural calculation

table_3_4$ACHnatural_cal <- as.numeric(table_3_4$ACH50_cal)/ as.numeric(n_factor_calculated$n_factor_cal)

table_3_4 <- table_3_4|>
 mutate(across(where(~ is.numeric(.)), ~ round(., 1)))

#Clean the data frame

table_3_4 <- cbind(table_3_4, n_factor_calculated)|>
  select(-c(5,6,7))|>
  pivot_longer(
    cols = everything(),
    names_to = "Info", 
    values_to = "Values")

equi_leak_area <- table_3_4[3,]
equi_leak_area <- table_3_4[3,]|>
  mutate(Values= paste0(equi_leak_area$Values, " under natural conditions. TEST"))

table_3_4 <- table_3_4|>
  rbind(equi_leak_area)

table_3_4 <- table_3_4[-3,]
  
table_3_4 <- table_3_4|>
  mutate(Info = recode(Info,  "as.numeric(table_3_4)" = "CFM50:", "ACH50_cal" = "ACH50:","equi_leak_area_cal" = "Equivalent leakage area:","ACHnatural_cal" = "ACHnatural:" ))|>
  arrange(factor(Info, levels = c('CFM50:', 'ACH50:', 'Equivalent leakage area:', 'ACHnatural:')))

table_3_4['Description'] <- c("CFM50 describes how many cubic feet per minute of air are leaving the house at 50 pascals of pressure difference (while the blower door is running). For every cubic foot of air that leaves the house, a cubic foot of air enters the house as well. The higher the number, the leakier the house.", "ACH50 tells us how many air changes per hour are taking place in the house at 50 pascals of pressure difference. This value is normalized for the volume of the house and thus allows for comparison between different houses. The higher the number, the leakier the house.","This is the area (in square inches) equivalent to all of the air leaks in the house combined.","Accounting for the volume of the home, this means that the house exchanges –% of its air every hour. Over one day, the house goes through – complete air changes.")




```

A blower door test simulates a 20mph wind hitting your house from all sides.

To run the test, we used a large fan in an exterior door to depressurize your house. As air is pulled out through the fan, an equal volume of air is pulled in through all of the gaps, cracks, and air leaks throughout the house. This allows us to determine the volume of air leakage into the house and to locate bigger air leaks.

To find leaks, we used an infrared camera to check for unusually hot and cold spots. We also checked the pressure differences of the rooms to help determine major air leak locations.

Air leaks are a big source of heat gain in warm weather and heat loss in cold weather. They also allow moisture to get into the home. Below are some numbers, pictures, and descriptions explaining what we found.

```{r}
#| label: 3.4 blower door table display
#| eval: true
#| echo: false
#gt_all_blower_door <- gt(all_blower_door) |>
  #tab_options(table.width = pct(100))|>
 # cols_width(
   # Info ~ px(150),
 #   Values ~ px(100),
#    Description ~ px(400)
#  )|>
# tab_options(column_labels.hidden = TRUE)

#gt_all_blower_door

gt_all_blower_door_auto <- gt(table_3_4) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Info ~ px(150),
    Values ~ px(100),
    Description ~ px(400)
  )|>
 tab_options(column_labels.hidden = TRUE)

gt_all_blower_door_auto
```



```{r}
#| label: ACHnatural ggplot chart
#| eval: true
#| echo: false
#| warning: false
#| output: false

#make ACH natural separated from other values

ACHnatural_ggplot <- table_3_4[-c(1:3),]
ACHnatural_ggplot$Values<- as.numeric(ACHnatural_ggplot$Values)

ggplot(ACHnatural_ggplot, aes(y=1))+
  geom_bar(width=0.5, fill ="#F5F5DC")+ #add8e6
  #scale_fill_gradient(low="#FF8888",high="#FF0000")+ #it should be working idk why it doesn't
   geom_vline(xintercept = ACHnatural_ggplot$Values, #move this to before previous x intercepts
                linetype=1, colour="#59D2FE", size= 3)+ #(maybe have coditional color? red if ACHn is to big blue if it's ok)
  #scale_x_reverse()+
  geom_vline(xintercept= c(0, 0.04, 0.35, 0.41, 0.6,1), size= 1.3, ylim)+
 
  
#The vline text lables
  geom_text(aes(x=ACHnatural_ggplot$Values, label="Your Home", y=1.15), nudge_x= -0.03, colour="#59D2FE", angle=90, size = 5, ) + #move this to the legend
  geom_text(aes(x=0, label="", y=1), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.04, label="Passive House", y=1), nudge_x= -0.02, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.35, label="Very Tight Mechanical \nVentilation Needed", y=1), nudge_x= -0.05, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.41, label="Tight", y=1), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.6, label="Leaky", y=1), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=1, label="Very Leaky", y=1), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  
#The vline text values 
  geom_text(aes(x=ACHnatural_ggplot$Values, label=ACHnatural_ggplot$Values, y=0.85), nudge_x= -0.03, colour="#59D2FE", angle=90, size = 5) + #move this to the legend
  geom_text(aes(x=0, label="0", y=0.8), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.04, label="0.04", y=0.8), nudge_x= -0.02, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.35, label="0.35", y=0.8), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.41, label="0.41", y=0.8), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=0.6, label="0.6", y=0.8), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  geom_text(aes(x=1, label="1", y=0.8), nudge_x= -0.03, colour="black", angle=90, size = 5, fontface="bold") +
  theme_void() 

ggsave("achnatural_ggplot1.png", width=15, height=5)



```

![](achnatural_ggplot1.png)

Using a thermal imaging camera, we looked for major air leakage locations and thermal bridging, where heat is bypassing the insulation. There was evidence of ….

### Attic

```{r}
#| label: 3.5 attic table
#| eval: true
#| echo: false
gt_all_attic <- gt(all_attic) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Info ~ px(200),
    Values ~ px(450),
  )|>
  tab_options(column_labels.hidden = TRUE)|>
  tab_options(table.font.size = 100)|>
  tab_style(
    style = list(
      cell_borders(
        sides = "all",
        color = "#000",
        weight = px(2)
      )),
    locations = cells_body()
  )
  #use it in all table to get rid of the column labels
  #cols_label(
   # Info = "",
   # Values = ""
  #)

gt_all_attic
```

### Basement

```{r}
#| label: 3.6 basement/crawlspace table
#| eval: true
#| echo: false
gt_all_basement <- gt(all_basement) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Info ~ px(200),
    Values ~ px(450),
  )|>
  tab_options(column_labels.hidden = TRUE)

gt_all_basement
```

### Electrical and Mechanical Systems

```{r}
#| label: setup 3.7 table
#| echo: false

all_electrical_mechanical <- clean_audit_data|>
  
  #select only needed columns
  select(amperage_of_breaker_panel, number_of_unused_breaker_spaces, comment_about_condition_of_the_panel_breakers_e_g_are_there_fuses_water_damage)|>
  
  #join information into one column for breaker panel in 3.7
  mutate('Electrical panel:'= paste0("The electrical panel has and  amperage of ", amperage_of_breaker_panel, ". There are ", number_of_unused_breaker_spaces, " unused breaker spaces. ", comment_about_condition_of_the_panel_breakers_e_g_are_there_fuses_water_damage))|>
  
  #delete unwanted columns, the once that were used to create joined columns
  select(-c(1:3))|>
  
  #pivot horizontal columns to be displayed vertical in the rows
  pivot_longer(cols = everything() ,
    names_to = "Info" ,
    values_to = "Values")
  
gt_all_electrical_mechanical <- gt(all_electrical_mechanical) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Info ~ px(200),
    Values ~ px(450),
  )|>
  tab_options(column_labels.hidden = TRUE)

gt_all_electrical_mechanical

```

### Energy Bills

```{r}
#| label: setup section 3.8
#| echo: false

quantity_energy_bills <- clean_audit_data|>
  
  #select all the columns that will be used
  select(gallons_of_heating_oil, gallons_of_kerosene, gallons_of_propane, k_wh_of_electricity, cords_of_firewood,  tons_of_pellets, write_the_quantity_and_measuring_unit)|>
  
   #pivot horizontal columns to be displayed vertical in the rows
  pivot_longer(cols = c(gallons_of_heating_oil, gallons_of_kerosene, gallons_of_propane, k_wh_of_electricity, cords_of_firewood,  tons_of_pellets, write_the_quantity_and_measuring_unit),
    names_to = "Type" ,
    values_to = "kWh/gallons/cords/tonns")|>
  mutate(Type = recode(Type, gallons_of_heating_oil = "Heating oil", gallons_of_kerosene = "Kerosene" , gallons_of_propane = "Propane", k_wh_of_electricity = "Electricity", cords_of_firewood = "Firewood",  tons_of_pellets = "Pellets", write_the_quantity_and_measuring_unit = "Type the name of other energy source"))
  

cost_energy_bills <- clean_audit_data|>
  select(cost_in_dollars_heating_oil, cost_in_dollars_kerosene, cost_in_dollars_propane, cost_in_dollars_electricity, cost_in_dollars_firewood, cost_in_dollars_pellets, cost_in_dollars_other)|>
  
  #pivot horizontal columns to be displayed vertical in the rows
  pivot_longer(cols = c(cost_in_dollars_heating_oil, cost_in_dollars_kerosene, cost_in_dollars_propane, cost_in_dollars_electricity, cost_in_dollars_firewood, cost_in_dollars_pellets, cost_in_dollars_other),
    names_to = "Type2" ,
    values_to = "Cost (USD)")

all_energy_bills <- quantity_energy_bills|>
  cbind(cost_energy_bills)|>
   filter(`Cost (USD)` != is.na(NA))#|>
   #select(-3)

gt_all_energy_bills <- gt(all_energy_bills) |>
  tab_options(table.width = pct(100))|>
  cols_width(
    Type ~ px(220),
    `kWh/gallons/cords/tonns` ~ px(220),
    `Cost (USD)` ~ px(220)
  )

gt_all_energy_bills
  
```

## Recommendations

These recommendations are organized from the least expensive/most cost-effective and easiest interventions to ones that are more challenging to implement.

```{r}
#| label: setup data for recommendations 4.0
#| echo: false
#| eval: true

furnice_boiler_tune_up <- clean_audit_data|>
  select(recommendations_ranking_furnace_boiler_tune_up)|>
  mutate(furnice_boiler_tune_up = str_detect(recommendations_ranking_furnace_boiler_tune_up, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_furnace_boiler_tune_up)

high_efficiency_shower_heads<- clean_audit_data|>
  select(recommendations_ranking_high_efficiency_showerhead_s)|>
  mutate(high_efficiency_shower_heads = str_detect(recommendations_ranking_high_efficiency_showerhead_s, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_high_efficiency_showerhead_s)

led<- clean_audit_data|>
  select(recommendations_ranking_le_ds)|>
  mutate(led = str_detect(recommendations_ranking_le_ds, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_le_ds)

window_dressers <- clean_audit_data|>
  select(recommendations_ranking_window_dressers)|>
  mutate(window_dressers = str_detect(recommendations_ranking_window_dressers, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_window_dressers)

refrigerator <- clean_audit_data|>
  select(recommendations_ranking_refrigerator)|>
  mutate(refrigerator = str_detect(recommendations_ranking_refrigerator, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_refrigerator)

 freezer<- clean_audit_data|>
  select(recommendations_ranking_freezer)|>
  mutate(freezer = str_detect(recommendations_ranking_freezer, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_freezer)
 
induction_stove<- clean_audit_data|>
  select(recommendations_ranking_induction_stove_oven)|>
  mutate(induction_stove = str_detect(recommendations_ranking_induction_stove_oven, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_induction_stove_oven)

heatpwh <- clean_audit_data|>
  select(recommendations_ranking_heat_pump_water_heater)|>
  mutate(heatpwh = str_detect(recommendations_ranking_heat_pump_water_heater, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_heat_pump_water_heater)

gutters <- clean_audit_data|>
  select(recommendations_ranking_gutters)|>
  mutate(gutters= str_detect(recommendations_ranking_gutters, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_gutters)

bathroom_exhaust_fan <- clean_audit_data|>
  select(recommendations_ranking_bathroom_exhaust_fan_s)|>
  mutate(bathroom_exhaust_fan = str_detect(recommendations_ranking_bathroom_exhaust_fan_s, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_bathroom_exhaust_fan_s)

kitchen_exhaust_fan <- clean_audit_data|>
  select(recommendations_ranking_kitchen_exhaust_fan)|>
  mutate(kitchen_exhaust_fan= str_detect(recommendations_ranking_kitchen_exhaust_fan, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_kitchen_exhaust_fan)

vapor_barrier <- clean_audit_data|>
  select(recommendations_ranking_vapor_barrier)|>
  mutate(vapor_barrier = str_detect(recommendations_ranking_vapor_barrier, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27"))|>
  select(-recommendations_ranking_vapor_barrier)

spray_foam <- clean_audit_data|>
  select(recommendations_ranking_spray_foam_basement_crawlspace_walls)|>
  mutate(spray_foam = str_detect(recommendations_ranking_spray_foam_basement_crawlspace_walls, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_spray_foam_basement_crawlspace_walls)

attic_air_sealing_and_insulation <- clean_audit_data|>
  select(recommendations_ranking_attic_insulation_and_air_sealing)|>
  mutate(attic_air_sealing_and_insulation = str_detect(recommendations_ranking_attic_insulation_and_air_sealing, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_attic_insulation_and_air_sealing)

wall_stud_insulation <- clean_audit_data|>
  select(recommendations_ranking_blown_in_cellulose_wall_insulation)|>
  mutate(wall_stud_insulation = str_detect(recommendations_ranking_blown_in_cellulose_wall_insulation, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_blown_in_cellulose_wall_insulation)

continuous_wall_insulation <- clean_audit_data|>
  select(recommendations_ranking_continuous_exterior_wall_insulation)|>
  mutate(continuous_wall_insulation = str_detect(recommendations_ranking_continuous_exterior_wall_insulation, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_continuous_exterior_wall_insulation)

electrical_panel <- clean_audit_data|>
  select(recommendations_ranking_electrical_panel_upgrade)|>
  mutate(electrical_panel = str_detect(recommendations_ranking_electrical_panel_upgrade, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_electrical_panel_upgrade)

airsource_hp <- clean_audit_data|>
  select(recommendations_ranking_air_source_heat_pump)|>
  mutate(airsource_hp = str_detect(recommendations_ranking_air_source_heat_pump, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_air_source_heat_pump)

ev <- clean_audit_data|>
  select(recommendations_ranking_ev_and_charger)|>
  mutate(ev = str_detect(recommendations_ranking_ev_and_charger, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_ev_and_charger)

solar <- clean_audit_data|>
  select(recommendations_ranking_solar)|>
  mutate(solar = str_detect(recommendations_ranking_solar, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_solar)

pipe_insulation <- clean_audit_data|>
  select(recommendations_ranking_pipe_insulation)|>
  mutate(pipe_insulation = str_detect(recommendations_ranking_pipe_insulation, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21"))|>
  select(-recommendations_ranking_pipe_insulation)

whole_house_surge_protection <- clean_audit_data|>
  select(recommendations_ranking_whole_house_surge_protection)|>
  mutate(whole_house_surge_protection = str_detect(recommendations_ranking_whole_house_surge_protection, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_whole_house_surge_protection)

diy_air_sealing <- clean_audit_data|>
  select(recommendations_ranking_diy_air_sealing)|>
  mutate(diy_air_sealing = str_detect(recommendations_ranking_diy_air_sealing, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21"))|>
  select(-recommendations_ranking_diy_air_sealing)

duck_air_sealing_and_insulation <- clean_audit_data|>
  select(recommendations_ranking_ductwork_air_sealing_and_insulation)|>
  mutate(duck_air_sealing_and_insulation = str_detect(recommendations_ranking_ductwork_air_sealing_and_insulation, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21"))|>
  select(-recommendations_ranking_ductwork_air_sealing_and_insulation)

#Need to add windows and doors and change all numbers to 28 range.

other_1 <- clean_audit_data|>
  select(recommendations_ranking_other_1)|>
  mutate(other_1 = str_detect(recommendations_ranking_other_1, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_other_1)

other_2 <- clean_audit_data|>
  select(recommendations_ranking_other_2)|>
  mutate(other_2 = str_detect(recommendations_ranking_other_2, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_other_2)

other_3 <- clean_audit_data|>
  select(recommendations_ranking_other_3)|>
  mutate(other_3 = str_detect(recommendations_ranking_other_3, pattern = "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26"))|>
  select(-recommendations_ranking_other_3)

```

```{r}
#| label: set up automatic recomendation stock text 
#| echo: false
a_refriginator <-  recommendations_googlesheets[5, ]

a_freezer <- recommendations_googlesheets[6,]

a_induction_stove <- recommendations_googlesheets[7, ]

a_vapor_barrier <- recommendations_googlesheets[12, ]

a_spray_foam <- recommendations_googlesheets[13, ]

a_attic_insulation <- recommendations_googlesheets[14, ]

a_blow_in_cellulose <- recommendations_googlesheets[15, ]

a_continuous_exterior_insulation <- recommendations_googlesheets[16, ]

a_electrical_panel_upgrade <- recommendations_googlesheets[17, ]

a_air_source_heat_pump <- recommendations_googlesheets[18, ]

a_ev_and_charger <- recommendations_googlesheets[19, ]

a_other_1 <- recommendations_googlesheets[21, ]

a_leds <- recommendations_googlesheets[3, ]

a_shower_heads <- recommendations_googlesheets[2, ]

a_furnice_boiler_tune_up <- recommendations_googlesheets[1, ]

a_window_dressers <- recommendations_googlesheets[4, ]

a_heat_pump_water_heater <- recommendations_googlesheets[8, ]

a_gutters <- recommendations_googlesheets[9, ]

a_bathroom_fan <- recommendations_googlesheets[10, ]

a_kitchen_fan <- recommendations_googlesheets[11, ]

a_solar <- recommendations_googlesheets[20, ]

a_pipe_insulation <- recommendations_googlesheets[22, ]

a_whole_house_surge_protection <- recommendations_googlesheets[23, ]

a_diy_air_sealing <- recommendations_googlesheets[24, ]

a_duct_air_sealing <- recommendations_googlesheets[27,]

a_other_2 <- recommendations_googlesheets[25, ]

a_other_3 <- recommendations_googlesheets[26, ]
```

```{r}
#| label: automatic conditioned recomendation stock text set up
#| echo: false
#| eval: false

residency_type <- clean_audit_data|>
  select(type_of_the_residence)

primery_residence <- residency_type |>
  mutate(type_of_the_residence = str_detect(type_of_the_residence, pattern = "Primary Residence"))

secondary_residence_heated <- residency_type |>
  mutate(type_of_the_residence = str_detect(type_of_the_residence, pattern = "Secondary Residence, heated year-round"))

secondary_residence_not_heated <- residency_type |>
  mutate(type_of_the_residence = str_detect(type_of_the_residence, pattern = "Secondary Residence, not heated year-round"))


auto_furnice_boiler_tune <- conditional_recommedations_googlesheets|>
  slice(1:3)


auto_furnice_boiler_tune <- if (primery_residence == TRUE) {
  mutate(auto_furnice_boiler_tune, Description = paste0("Test1"))
} else if (secondary_residence_heated == TRUE) {
  mutate(auto_furnice_boiler_tune, Description = paste0("Test2"))
} else {
  mutate(auto_furnice_boiler_tune, Description = paste0("Test3"))
}
```


```{r}
#| label: furnace boiler tune up recommendation
#| echo: false
#| results: asis


if(furnice_boiler_tune_up == TRUE){
  cat("### Furnace/Boiler Tune up
  
*Problem*

** Auditor to describe.**

*Recommendation* "

)
}else{
  cat("")
}

if(furnice_boiler_tune_up == TRUE){
  cat(a_furnice_boiler_tune_up$Description
  )
}else{
  cat("")
  }

if(furnice_boiler_tune_up == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

A tune-up can improve the efficiency of your furnace/boiler, confirm that it is exhausting properly, and identify areas of concern before they become urgent. If you have a service contract with your fuel delivery company, an annual tune-up is usually included. 

")
}else{
  cat("")
  }

```

```{r}
#| label: high efficiency shower head(s) recommendation
#| echo: false
#| results: asis


if( high_efficiency_shower_heads == TRUE){
  cat("### High efficiency shower head(s)
  
*Problem*

Your shower heads use more water and energy than high-efficiency shower heads, thus costing you more money than necessary. Older shower heads use 2.5 gallons or more every minute, which wastes thousands of gallons of water each year and costs you money for every extra gallon of water heated. 

*Recommendation* ")
}else{
  cat("")
  }

if(high_efficiency_shower_heads == TRUE){
  cat(a_shower_heads$Description
    
  )
}else{
  cat("")
  }

if(high_efficiency_shower_heads == TRUE){
  cat("
*Estimated Cost/Benefits/Incentives*

A typical family will save ~10,000 gallons of water per year and over $100 per year in water heating costs. We provide these for free and have several styles for you to choose from; contact us for some if we did not give you any during the audit.
")
}else{
  cat("")
  }
```

```{r}
#| label: leds recommendation
#| echo: false
#| results: asis


if( led == TRUE){
  cat("### LEDs
  
*Problem*

Your lighting uses more energy than LED bulbs would. Halogen and incandescent light bulbs use 5-8x more energy than LEDs. This requires significantly more electricity and costs a lot.

*Recommendation*")
}else{
  cat("")
}

if(led == TRUE){
  cat(a_leds$Description
    
  )
}else{
  cat("")
  }

if(led == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

We provide free LED light bulbs; contact us for some if we did not give you any during the audit. Depending on usage, LEDs can save more than $50 a year.

")
}else{
  cat("")
  }

```

```{r}
#| label: Windows Dressers recommendation
#| echo: false
#| results: asis


if( window_dressers == TRUE){
  cat("### Window Dressers
  
*Problem*

Your windows are a source of heat loss, reduce your comfort due to cold surface temperatures, and may also cause moisture condensation or frost in the winter. 

*Recommendation*"
)
}else{
  cat("")
}

if(window_dressers == TRUE){
  cat(a_window_dressers$Description
    
  )
}else{
  cat("")
  }

if(window_dressers == TRUE){
  cat("
*Estimated Cost/Benefits/Incentives*

Insulating window inserts save 5-10% of your heating costs at less than 1/10th the cost of replacement windows. The overall project cost will depend on the number and size of window inserts. Example prices for 2024: small (20 x 36”) - $36 for natural pine frame, $46 for white; medium (30 x 52”) - $50 for natural pine frame, $64 for white; large (44 x 68”) - $67 for natural pine frame, $88 for white. Adjusted pricing for lower-income households is available from WindowDressers upon request. If plastic is damaged, it can be replaced for $15. 
Households that order inserts are expected to participate in the Community Build where the inserts are made. You can sign up for a 4-hour shift and learn the simple steps in the insert-building process (no previous experience required, no power tools). Each job has “jigs” that make the job easier to do and ensure uniform quality. You will be trained at the beginning of your shift on how to do your task. Volunteering for multiple shifts is encouraged! Mid-shift snacks and a meal are provided to all participants.
If you would like to participate, please contact us so we can discuss how the program works and which windows you’d like inserts for. 
")
}else{
  cat("")
  }

```

```{r}
#| label: refrigerator recommendation
#| echo: false
#| results: asis


if( refrigerator == TRUE){
  cat("### Refrigerator
  
*Problem*

Your refrigerator uses more energy than newer models. **Ideally, the auditor notes the annual energy consumption (kWh) of the existing fridge compared to a new model of similar size. 

*Recommendation*")
}else{
  cat("")
}

if(refrigerator == TRUE){
  cat(a_refriginator$Description
    
  )
}else{
  cat("")
  }

if(refrigerator == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

If you are able to afford the upfront cost of purchasing a new refrigerator, you will recoup significant savings in the long run. Whenever you need to buy a new appliance, consider EnergyStar certified models, which use less energy and are cheaper to run. Remember, it doesn’t save energy if you relocate your existing refrigerator to the basement or garage and continue using it.

** Ideally, auditor locates similar volume fridge online to calculate monthly savings and payback period compared to kill-a-watt meter reading for current refrigerator. “This example refrigerator would save $XX in electricity each month and pay for itself within XX months.”**")
}else{
  cat("")
  }
```

```{r}
#| label: freezer recommendation
#| echo: false
#| results: asis


if( freezer == TRUE){
  cat("### Freezer
  
*Problem*

Your freezer uses more energy than newer models. Consider how the cost of running the freezer compares to the benefits of keeping it on. **Ideally, the auditor notes the annual energy consumption (kWh) of the existing freezer compared to a new model of similar size. 

*Recommendation*")
}else{
  cat("")
}

if(freezer == TRUE){
  cat(a_freezer$Description
    
  )
}else{
  cat("")
  }

if(freezer == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*


If you are able to afford the upfront cost of purchasing a new freezer, you will recoup significant savings in the long run. Whenever you need to buy a new appliance, consider EnergyStar certified models, which use electricity and are cheaper to run. 

** Ideally, auditor locates similar volume freezer online to calculate monthly savings and payback period compared to kill-a-watt meter reading for current  freezer. “This example freezer would save $XX in electricity each month and pay for itself within XX months.”")
}else{
  cat("")
  }
```

```{r}
#| label: induction stove recommendation
#| echo: false
#| results: asis


if( induction_stove== TRUE){
  cat("### Induction Stove/Oven
  
*Problem*

Your gas range has the potential to release propane, carbon monoxide, and combustion gases into your house. Gas ranges are also inefficient at transferring heat to your food at 32% efficiency, compared to 85% efficiency for induction cooktops. 

*Recommendation*")
}else{
  cat("")
}

if(induction_stove == TRUE){
  cat(a_induction_stove$Description
    
  )
}else{
  cat("")
  }

if(induction_stove == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

Currently, Efficiency Maine does not offer a rebate for induction stoves. If you’re interested in trying out induction cooking but don’t want to replace your kitchen stove, consider buying a portable induction cooktop, which costs less than $100.")
}else{
  cat("")
  }
```

```{r}
#| label: heat pump water heater recommendation
#| echo: false
#| results: asis


if( heatpwh == TRUE){
  cat("### Heat Pump Water Heater
  
*Problem*


** Auditor to describe depending on what their current system is. **

*Recommendation*")
}else{
  cat("")
}

if(heatpwh == TRUE){
  cat(a_heat_pump_water_heater$Description
    
  )
}else{
  cat("")
  }

if(heatpwh == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

A heat pump water heater uses 70% less electricity than a standard electric water heater. Depending on your income, Efficiency Maine offers a no-cost program for low-income households, or a rebate of up to $1,000 for everyone else, making the equipment cost as little as $400 plus installation. The rebate can be combined with a federal tax credit of 30% of the remaining cost. For more information, you can call Efficiency Maine at 866-376-2463 (Monday to Friday, 8:00 am to 5:00 pm) or visit their website: https://www.efficiencymaine.com/at-home/heat-pump-water-heater-program/ 


")
}else{
  cat("")
  }
```

```{r}
#| label: Gutters recommendation
#| echo: false
#| results: asis


if( gutters == TRUE){
  cat("### Gutters
  
*Problem*


The house has no gutters, so water runs off your roof and directly onto the ground next to your house. Water that splashes off the ground can damage the exterior of your house. Runoff that is absorbed into the ground can seep into the basement/crawlspace, causing moisture issues there and throughout your house. 

*Recommendation*")
}else{
  cat("")
}

if(gutters == TRUE){
  cat(a_gutters$Description
    
  )
}else{
  cat("")
  }

if(gutters == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

Adding gutters would mitigate moisture damage and save you from having to replace/fix other parts of the house.")
}else{
  cat("")
  }
```

```{r}
#| label: bathroom exhaust fan(s) recommendation
#| echo: false
#| results: asis


if( bathroom_exhaust_fan == TRUE){
  cat("### Bathroom exhaust fan(s)
  
*Problem*

Currently, there is no bathroom exhaust fan, so moisture from the shower, toilet, and sink remains in the house, which can cause moisture issues such as mold.

*Recommendation*")
}else{
  cat("")
}

if(bathroom_exhaust_fan == TRUE){
  cat(a_bathroom_fan$Description
    
  )
}else{
  cat("")
  }

if(bathroom_exhaust_fan == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

The typical fan is around $130 plus the cost of installation.")
}else{
  cat("")
  }
```

```{r}
#| label: kitchen exhaust fan recommendation
#| echo: false
#| results: asis


if( kitchen_exhaust_fan == TRUE){
  cat("### Kitchen exhaust fan(s)
  
*Problem*

Currently, there is no kitchen exhaust fan, so fumes, smoke, and moisture from cooking stay in the house which can cause health concerns.

*Recommendation*")
}else{
  cat("")
}

if(kitchen_exhaust_fan == TRUE){
  cat(a_kitchen_fan$Description
    
  )
}else{
  cat("")
  }

if(kitchen_exhaust_fan == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

Kitchen range hoods typically cost $150 or more; installation costs depend on the complexity of the exhaust ducting.

")
}else{
  cat("")
  }
```

```{r}
#| label: vapor barrier recommendation
#| echo: false
#| results: asis


if( vapor_barrier == TRUE){
  cat("### Vapor Barrier
  
*Problem*

There is excess moisture in the basement/crawlspace, which is evaporating out of the ground. This moisture can enter the house and cause mold, mildew, rot, and air quality issues.

*Recommendation*")
}else{
  cat("")
}

if(vapor_barrier == TRUE){
  cat(a_vapor_barrier$Description
    
  )
}else{
  cat("")
  }

if(vapor_barrier == TRUE){
  cat(" Vapor barriers typically consist of either reinforced plastic sheeting or EPDM rubber membrane over a ‘dimple mat’ that allows for drainage below the vapor barrier and prevents rocks from puncturing it. If the basement/crawlspace walls are going to be spray foamed, we recommend the foam go all the way to the floor and overlap the vapor barrier to create a continuous air and moisture barrier.

*Estimated Cost/Benefits/Incentives*

Efficiency Maine rebates will cover vapor barriers up to 25% of a weatherization project cost, if done as part of a larger insulation project. Efficiency Maine rebates and other incentives for insulation work can fund up to 80% of the project cost, up to $9,200 when combined with federal tax credits. You can call them at 866-376-2463 (Monday to Friday, 8:00 am to 5:00 pm) or visit their webpage about insulation rebates: https://www.efficiencymaine.com/at-home/insulation-rebates-after-7-31-2023/
Most insulation companies install spray foam and vapor barriers. We recommend doing insulation and air sealing work in the basement and attic at the same time and with the same contractor to save money and time and take full advantage of the Efficiency Maine rebates.")
}else{
  cat("")
  }
```

```{r}
#| label: spray foam recommendation
#| echo: false
#| results: asis


if( spray_foam == TRUE){
  cat("### Spray foam Basement Walls
  
*Problem*

The basement/crawlspace is uninsulated and used for mechanical equipment and plumbing. The walls are porous and allow moisture into the house and rapidly conduct heat out of the space. 

*Recommendation*")
}else{
  cat("")
}

if(spray_foam == TRUE){
  cat(a_spray_foam$Description
    
  )
}else{
  cat("")
  }

if(spray_foam == TRUE){
  cat(" In older homes, most heat loss is due to air leakage. Air sealing is particularly important in the basement or crawlspace (and attic). As warm air rises and leaks out the top of your home, cold air is pulled in at the bottom. This is called the ‘stack effect’, and is more pronounced in taller homes. Thus, air sealing is necessary anywhere gaps allow air to move into your house through the basement/crawlspace. 

Spray foam should be applied 2-3 inches thick on the walls to seal and insulate them. It is often ideal to install a vapor barrier at the same time as the spray foam insulation. Spray foam generally requires a layer of intumescent (fire-rated) paint over it to meet fire code.

*Estimated Cost/Benefits/Incentives*

Installation of spray foam insulation will cost around $5-7 per square foot. Efficiency Maine rebates and other incentives for insulation work can fund up to 80% of the project cost, up to $9,200 when combined with federal tax credits. You can call them at 866-376-2463 (Monday to Friday, 8:00 am to 5:00 pm) or visit their webpage about insulation rebates: https://www.efficiencymaine.com/at-home/insulation-rebates-after-7-31-2023/ 
Most insulation companies install spray foam and vapor barriers. We recommend discussing insulation and air sealing work in the basement, walls, and attic with contractors at the same time to save money and time and take full advantage of the Efficiency Maine rebates.

")
}else{
  cat("")
  }
```

```{r}
#| label: attic air sealing and insulation recommendation
#| echo: false
#| results: asis


if(attic_air_sealing_and_insulation == TRUE){
  cat("### Attic Insulation and Air Sealing
  
*Problem*

The attic is uninsulated or is missing insulation and the attic could also benefit from air-sealing. These upgrades will reduce draftiness and heat loss in the winter and heat gain in the summer. 

*Recommendation*")
}else{
  cat("")
}

if(attic_air_sealing_and_insulation == TRUE){
  cat(a_attic_insulation$Description
    
  )
}else{
  cat("")
  }

if(attic_air_sealing_and_insulation == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*


Efficiency Maine rebates and other incentives for insulation work can fund up to 80% of the project cost, up to $9,200 when combined with federal tax credits. You can call them at 866-376-2463 (Monday to Friday, 8:00 am to 5:00 pm) or visit their webpage about insulation rebates: https://www.efficiencymaine.com/at-home/insulation-rebates-after-7-31-2023/   
We recommend discussing insulation and air sealing work in the basement, walls, and attic with contractors at the same time to save money and time and take full advantage of the Efficiency Maine rebates.

")
}else{
  cat("")
  }
```

```{r}
#| label: wall stud insulation recommendation
#| echo: false
#| results: asis


if( wall_stud_insulation== TRUE){
  cat("### Blow-in cellulose wall insulation
  
*Problem*

The walls of the house are uninsulated, which is a significant source of heat loss.

*Recommendation*")
}else{
  cat("")
}

if(wall_stud_insulation == TRUE){
  cat(a_blow_in_cellulose$Description
    
  )
}else{
  cat("")
  }

if(wall_stud_insulation == TRUE){
  cat(" In balloon-framed homes, this can often be done from the attic, otherwise it can be done by drilling holes into the wall cavities from either the inside or outside.

*Estimated Cost/Benefits/Incentives*

Efficiency Maine rebates and other incentives for insulation work can fund up to 80% of the project cost, up to $9,200 when combined with federal tax credits. You can call them at 866-376-2463 (Monday to Friday, 8:00 am to 5:00 pm) or visit their webpage about insulation rebates: https://www.efficiencymaine.com/at-home/insulation-rebates-after-7-31-2023/   
This could be combined with other insulation work using the same contractor to save money and time and take full advantage of the Efficiency Maine rebates.

")
}else{
  cat("")
  }
```

```{r}
#| label: continuous wall insulation recommendation
#| echo: false
#| results: asis


if( continuous_wall_insulation== TRUE){
  cat("### Continuous exterior wall insulation
  
*Problem*

There isn’t continuous insulation between the siding and the exterior walls of the house. Continuous insulation helps create a complete thermal boundary for your house, and it is now an energy code requirement for new houses.

*Recommendation*")
}else{
  cat("")
}

if(continuous_wall_insulation == TRUE){
  cat(a_continuous_exterior_insulation$Description
    
  )
}else{
  cat("")
  }

if(continuous_wall_insulation == TRUE){
  cat(" Add continuous insulation (R-6 or more) under the new siding to keep the house warmer in the winter and cooler in the summer. We recommend TimberHP TimberBoard insulation (produced in Madison, Maine) or Rockwool Comfortboard, but foam board can also be used. Before installing exterior insulation, the contractor can check if insulation is needed between the interior wall studs.

*Estimated Cost/Benefits/Incentives*

Efficiency Maine rebates and other incentives for insulation work can fund up to 80% of the project cost, up to $9,200 when combined with federal tax credits. You can call them at 866-376-2463 (Monday to Friday, 8:00 am to 5:00 pm) or visit their webpage about insulation rebates: https://www.efficiencymaine.com/at-home/insulation-rebates-after-7-31-2023/   
This could be combined with other insulation work using the same contractor to save money and time and take full advantage of the Efficiency Maine rebates. ")
}else{
  cat("")
  }
```

```{r}
#| label: electrical panel upgrade recommendation
#| echo: false
#| results: asis


if( electrical_panel == TRUE){
  cat("### Electrical Panel Upgrade
  
*Problem*

** Auditor to describe.

*Recommendation*")
}else{
  cat("")
}

if(electrical_panel == TRUE){
  cat(a_electrical_panel_upgrade$Description
    
    )
}else{
  cat("")
  }

if(electrical_panel == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

Costs of electrical components needed to support residential energy upgrades – including panels, sub-panels, branch circuits, and feeders – qualify for a 30% nonrefundable tax credit (up to $600 per item) if they have a capacity of 200 amps or more. This is a also good opportunity for an electrician to install whole-house surge protection, which costs $100-$400. Here are some options: https://www.popularmechanics.com/home/interior-projects/g43140886/best-whole-house-surge-protectors/")
}else{
  cat("")
  }
```

```{r}
#| label: air source heat pump(s) recommendation
#| echo: false
#| results: asis


if( airsource_hp == TRUE){
  cat("### Air Source Heat Pump
  
*Problem*

Combustion heating equipment is expensive, inefficient, and has the potential to release harmful combustion gases like carbon monoxide into the home.

*Recommendation*")
}else{
  cat("")
}

if(airsource_hp == TRUE){
  cat(a_air_source_heat_pump$Description
    
  )
}else{
  cat("")
  }

if(airsource_hp == TRUE){
  cat(" Air source heat pumps can be up to 300% efficient and heat, cool, and dehumidify your house. A qualified installer will help determine what size system to install and where. Whole-house surge protection will protect your appliances and heat pumps from being damaged by an electrical surge.

*Estimated Cost/Benefits/Incentives*

Efficiency Maine rebates can fund up to 80% of the project cost (depending on income level) to install heat pumps, and federal tax credits can cover 30% of the remaining cost (up to $2,000 per year). You can call Efficiency Maine at 866-376-2463 (Monday to Friday, 8:00 am to 5:00 pm) or visit their website: https://www.efficiencymaine.com/at-home/whole-home-heat-pump-incentives/ 
A whole-house surge protection device costs $100-$400 and needs to be installed by an electrician. Here are some options: https://www.popularmechanics.com/home/interior-projects/g43140886/best-whole-house-surge-protectors/")
}else{
  cat("")
  }
```

```{r}
#| label: EV recommendation
#| echo: false
#| results: asis


if( ev == TRUE){
  cat("### Electric Vehicle and charger
  
*Problem*

Transportation, and particularly personal vehicles, are the leading cause of emissions in Maine. When you are planning to purchase a new vehicle, please consider a plug-in hybrid or all-electric vehicle.

*Recommendation*")
}else{
  cat("")
}

if(ev == TRUE){
  cat(a_ev_and_charger$Description
    
  )
}else{
  cat("")
  }

if( ev == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

You can review current state and federal financial incentives for electric vehicles here: https://www.electricforall.org/rebates-incentives/
")
}else{
  cat("")
  }
```

```{r}
#| label: solar recommendation
#| echo: false
#| results: asis


if( solar == TRUE){
  cat("### Solar
  
*Problem*

** Auditor to describe (or remove this section).

*Recommendation*")
}else{
  cat("")
}

if(solar == TRUE){
  cat(a_solar$Description
    
  )
}else{
  cat("")
  }

if(solar == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

There is a 30% federal tax credit and financing options are available. Battery backup is needed for solar to work during a power outage.
")
}else{
  cat("")
  }
```

```{r}
#| label: pipe insulation recommendation
#| echo: false
#| results: asis


if(pipe_insulation == TRUE){
  cat("### Pipe Insulation
  
*Problem*

Uninsulated water pipes are responsible for heat loss and excess moisture (from condensation) in your basement/crawlspace.

*Recommendation*")
}else{
  cat("")
}

if(pipe_insulation == TRUE){
  cat(a_pipe_insulation$Description
    
  )
}else{
  cat("")
  }

if(pipe_insulation == TRUE){
  cat("We recommend foam pipe insulation made of polyethylene or neoprene. 

*Estimated Cost/Benefits/Incentives*

Insulating water pipes can save 2%-4% on hot water bills and increase the temperature of the water while reducing the time it takes for hot water to reach your tap. Materials cost around $100-200, depending on the length of pipe to insulate. Many people find this to be an easy project to do themselves.
")
}else{
  cat("")
  }
```

```{r}
#| label: whole house surge protection recommendation
#| echo: false
#| results: asis


if( whole_house_surge_protection == TRUE){
  cat("### Whole House Surge Protection
  
*Problem*

Your house does not have whole-house surge protection. This will protect your large electrical appliances from damage in the case of an electrical surge. Heat pumps, heat pump water heaters, and other electronics are particularly sensitive to electrical surges. 

*Recommendation*")
}else{
  cat("")
}

if(whole_house_surge_protection == TRUE){
  cat(a_whole_house_surge_protection$Description
    
  )
}else{
  cat("")
  }

if(whole_house_surge_protection == TRUE){
  cat("This will help to protect your heat pumps, heat pump water heater, refrigerator, well pump, and other electronics from damage due to lightning or other electrical surges. 

*Estimated Cost/Benefits/Incentives*

The device costs $100-$400 and needs to be installed by an electrician. Here are some options: https://www.popularmechanics.com/home/interior-projects/g43140886/best-whole-house-surge-protectors/
")
}else{
  cat("")
  }
```

```{r}
#| label: diy air sealing recommendation
#| echo: false
#| results: asis


if( diy_air_sealing == TRUE){
  cat("### diy. Air Sealing
  
*Problem*

During the blower door test, we noted sources of air leakage in the living areas of your house. **Auditor to detail customized findings. **

*Recommendation*")
}else{
  cat("")
}

if(diy_air_sealing == TRUE){
  cat(a_diy_air_sealing$Description
    
  )
}else{
  cat("")
  }

if(diy_air_sealing == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

Air sealing the air leaks we identified around the living areas of your house can be a DIY solution to lower energy use, or an insulation contractor can seal the leaks when they come to your house for a larger project. Please address any moisture concerns before undertaking significant air sealing efforts.
")
}else{
  cat("")
  }
```

```{r}
#| label: other 1 recommendation
#| echo: false
#| results: asis


if( other_1 == TRUE){
  cat("### Other 1
  
*Problem*

*Recommendation*

")
}else{
  cat("")
}

if(other_1 == TRUE){
  cat(a_other_1$Description
    
  )
}else{
  cat("")
  }

if(other_1 == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*
")
}else{
  cat("")
  }
```

```{r}
#| label: other 2 recommendation
#| echo: false
#| results: asis


if( other_2 == TRUE){
  cat("### Other 2
  
*Problem*

*Recommendation*

")
}else{
  cat("")
}

if(other_2 == TRUE){
  cat(a_other_2$Description
    
  )
}else{
  cat("")
  }

if(other_2 == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*
")
}else{
  cat("")
  }
```

```{r}
#| label: other 3 recommendation
#| echo: false
#| results: asis


if( other_3 == TRUE){
  cat("### Other 3
  
*Problem*

*Recommendation*

")
}else{
  cat("")
}

if(other_3 == TRUE){
  cat(a_other_3$Description
    
  )
}else{
  cat("")
  }

if(other_3 == TRUE){
  cat("

*Estimated Cost/Benefits/Incentives*

")
}else{
  cat("")
  }
```

```{r}
#| label: surge protection
#| echo: false
#| results: asis


if( whole_house_surge_protection == TRUE){
  cat("### Whole-House Surge Protection
  
*Problem*

Your house does not have whole-house surge protection. This will protect your large electrical appliances from damage in the case of an electrical surge. Heat pumps, heat pump water heaters, and other electronics are particularly sensitive to electrical surges. 

*Recommendation*

Upgrade your electrical panel to add whole-house surge protection. This will help to protect your heat pumps, heat pump water heater, refrigerator, well pump, and other electronics from damage due to lightning or other electrical surges. 


")
}else{
  cat("")
}

if( whole_house_surge_protection == TRUE){
  cat(a_whole_house_surge_protection$Description)
}else{
  cat("")
}

if(whole_house_surge_protection == TRUE){
  cat("*Estimated Costs/Benefits/Incentives*

The device costs $100-$400 and needs to be installed by an electrician. Here are some options: https://www.popularmechanics.com/home/interior-projects/g43140886/best-whole-house-surge-protectors/ 
")
}else{
  cat("")
}
```

```{r}
#| label: diy. Air Sealing
#| echo: false
#| results: asis


if( diy_air_sealing == TRUE){
  cat("### diy. Air Sealing
  
*Problem*

During the blower door test, we noted sources of air leakage in the living areas of your house. **Auditor to detail customized findings. 

*Recommendation*")
}else{
  cat("")
}

if( diy_air_sealing == TRUE){
  cat(a_diy_air_sealing$Description)
}else{
  cat("")
}

if(diy_air_sealing == TRUE){
  cat("*Estimated Costs/Benefits/Incentives*

Air sealing the air leaks we identified around the living areas of your house can be a DIY solution to lower energy use, or an insulation contractor can seal the leaks when they come to your house for a larger project. Please address any moisture concerns before undertaking significant air sealing efforts.
")
}else{
  cat("")
  }
```

```{r}
#| label: Ductwork Air Sealing and Insulation
#| echo: false
#| results: asis


if( duck_air_sealing_and_insulation == TRUE){
  cat("### Ductwork Air Sealing and Insulation
  
*Problem*

The furnace supply ductwork running through the basement would be more efficient if it were air sealed and insulated. The heated air from the furnace loses a lot of heat to the surroundings on its way to the living space.

*Recommendation*")
}else{
  cat("")
}

if( duck_air_sealing_and_insulation == TRUE){
  cat(a_duct_air_sealing$Description)
}else{
  cat("")
}

if(duck_air_sealing_and_insulation == TRUE){
  cat("*Estimated Costs/Benefits/Incentives*

Air sealing and insulating ductwork is eligible for a non-refundable federal tax credit (“Energy Efficient Home Improvement Credit”), which can pay for 30% of the project cost, subject to an annual maximum of $1200 (shared with other home envelope improvements, like attic and basement projects).
")
}else{
  cat("")
  }

```

```{r}
#| label: Additional Resources
#| echo: false
#| results: asis
#| 
cat("## Additional Resources

Many home efficiency upgrades are eligible for Efficiency Maine rebates and federal tax credits. Financial incentives vary based on income level and type of occupancy. An overview of all state rebates and federal tax credits can be found here: https://www.efficiencymaine.com/at-home/ 

You can search for Efficiency Maine registered contractors here: https://www.efficiencymaine.com/at-home/vendor-locator/ 

Our Maine Energy Upgrade Program team is willing and able to help you sort out the details of incentives and recommend contractors who have done quality work. 

**As part of our program, we plan to coordinate with homeowners and contractors to bundle multiple projects together to reduce costs. We will also pay for barging costs for materials, contractor vehicles, and other necessary equipment to make energy upgrades. To qualify for our program, homes must install either a heat pump or heat pump water heater in addition to any other improvements.
")
```





