---
title: "COA Community Energy Center"
format: html
editor: visual
params:
  adress: "Me_test1"
  author: "Rudolfs"
---

```{r}
#| label: load packages
#| echo: false
#| warning: false

#Attach Packages
library(readr)
library(here)
library(dplyr)
library(ggplot2)
library(stringr)
library(readxl)
library(tidyverse)

```

```{r}
#| label: setup data
#| echo: false
#| warning: false

#Load Data
Energy_Audits <- read_excel("../data/Energy_Audit_template.xlsx")

Building_Audit <- Energy_Audits |>
  filter(Adress_Name == params$adress) # Auditor_full_name == params$Auditor_full_name

```

##Home Energy Audit Report 

Photo here of the house SUBMITTED TO: `r params$adress`

SUBMITTED BY: `r params$author` DATE: `r format(Sys.time(), '%e %B %Y')`

## Summary

Energy Audit of your property was conducted on `r Building_Audit$Audit_Date` We looked into insulation, mechanical equipment, conducted test like blower door test to quantify the energy efficiency of your home. By analyzing collected and all the data that you provided your home energy cost your approximately `r Building_Audit$Yearly_Energy_Cost` yearly. (This report also shows the list of improvements that could lower energy consumption and improve comfort and health)

## Home's current conditions

::: {layout-ncol="2"}
Build: `r Building_Audit$Year_Build`

Volume: `r Building_Audit$Total_floor_area`

Area: `r Building_Audit$Total_floor_area`

Window type and area: `r Building_Audit$Window_type`, `r Building_Audit$Window_area`

Heating type: `r Building_Audit$Heating_Type`

Door type and area: `r Building_Audit$Door_type`, `r Building_Audit$Door_area`

Total floor area: `r Building_Audit$Total_floor_area`

Net wall area: `r Building_Audit$Net_wall_area`

Ceiling height: `r Building_Audit$Ceiling_height`

Ceiling/attic area: `r Building_Audit$"Ceiling/attic_area"`
:::

## Health and safety

Combustion Gas Spillage Test – `r case_when(Building_Audit$"Seconds of Combustion Gas Spillage Test" >= 60 ~ 'FAILED',TRUE ~ 'PASSED')` (Emissions Spilled for `r Building_Audit$"Seconds of Combustion Gas Spillage Test"` seconds)

(This can be optional in a longer report)The Combustion Gas Spillage Test examines your current combustion appliances for spillage of emissions into your home. Most combustion appliances spill for a short period of time, especially when they are first starting. An appliance that spills emissions for more than 60 seconds fails the test and corrective action is needed. This is often due to a clogged or restricted chimney.

Appliance Carbon Monoxide (CO) Test – `r case_when(Building_Audit$"Appliance Carbon Monoxide (CO) Test" > 26 ~ 'FAILED',TRUE ~ 'PASSED')`( Detected `r Building_Audit$"Appliance Carbon Monoxide (CO) Test"`parts per million)

(This can be optional in a longer report) The Appliance Carbon Monoxide test examines the concentration of CO inside of the chimney/flue that is designed to vent the emissions of the combustion process out of your home. If levels of CO in the emissions of your combustion appliance exceeds 26 parts per million, correction action is highly recommended. If they exceed 100 parts per million corrective action is needed. CO is produced from incomplete combustion, so often times a clean and tune of your appliance is the best fix.

Ambient Carbon Monoxide (CO) Test – `r case_when(Building_Audit$"Carbon Monoxide (CO)parts per million Test" > 35 ~ 'FAILED',TRUE ~ 'PASSED')` (Detected `r Building_Audit$"Carbon Monoxide (CO)parts per million Test"` parts per million)

(This can be optional in a longer report) The Ambient Carbon Monoxide test examines the inside of your home for the presence of CO. All homes with combustion appliances and/or attached garages must to have UL2034 listed carbon monoxide detectors installed in the appropriate locations. If levels of CO in your home reach 35 parts per million the appliance creating the problem should be disabled and the home should be evacuated and ventilated until levels fall below 35 PPM. The appliance should then be repaired or replaced.

Combustion Appliance Draft Test – `r Building_Audit$"Combustion Appliance Draft Test (PASSED/FAILED)"` 

(This can be optional in a longer report) The Combustion Appliance Draft Test evaluates the risk that the combustion gases in your home’s flue(s) will be drawn back into your home by a source of negative pressure (e.g. clothes dryer, bathroom fans, etc…) If a combustion appliance does not have sufficient draft pressure corrective action is required.

Gas leak detection: `r Building_Audit$"Gas leak detection(PASSED/FAILED)"`

Other Health & Safety Concerns: `r case_when(Building_Audit$"Other Health & Safety Concerns" > 35 ~ 'FAILED',TRUE ~ 'PASSED')` if there is some comment if not default to this - (There were no health and safety concerns that were identified at the time of your energy audit.)

## Air quality



## Insulation levels

|                    |                                                 |                               |
|------------------------|----------------------------|--------------------|
| HOME COMPONENT     | YOUR HOME’S R-VALUES                            | US D.O.E.RECOMMENDED R-VALUES |
| Attics/Ceilings    | `r Building_Audit$"Attics/Ceilings R-value"`    | 49                            |
| Above Ground Walls | `r Building_Audit$"Above Ground Walls R-value"` | 20                            |
| Basement Walls     | `r Building_Audit$"Basement Walls R-value"`     | 15                            |
| Basement Ceilings  | `r Building_Audit$"Basement Ceilings R-value"`  | 25                            |

link to US D.O.E. RECOMMENDED R-VALUES

Images of the insulation pictures.

## Air Leakage Test

The blower door test, determined that your homes air leakage rate is `r Building_Audit$"Natural Air Changes per Hour(ACHn)"`Natural Air Changes per Hour(ACHn) (Should I explain what ACHn is?) CFM50 was `r Building_Audit$"CFM50 reading"` with `r Building_Audit$"Ring Used"` ring used. (Include photo)
```{r}
#| label: setup air leakage data
ACHn <- Building_Audit |>
  select("Natural Air Changes per Hour(ACHn)")|>
  mutate()
ACHn1 <- data.frame(IdialACHn = c(1))
airleakdata <- cbind(ACHn,ACHn1)  
```

```{r}
#| label: air leakage tests ggplot
#| warning: false

ggplot(Building_Audit, aes(y="Natural Air Changes per Hour(ACHn)", x="Natural Air Changes per Hour(ACHn)")) + 
    geom_bar(position="fill", stat="identity")

#Here will be a singular bar plat with air leak visualization
```

The blower door test and visual inspection detected the following areas for moderate to severe air leakage:

(This would be pictures)

`{r} reference to df.`

`{r} reference to df.`

`{r} reference to df.`

## 

Heating and Cooling Systems

(Image of heating system) Your home is currently heated with an `r Building_Audit$"Heater Type"` Your current heating system has the following efficiency and output ratings:

-   Heating efficiency = `r Building_Audit$"Heating Efficiency"`

-   Annual Fuel Utilization Efficiency (AFUE)(need a new column here)

-   Heating output = `r Building_Audit$"Heating output"` Btu/hr.

Your home is cooled with (need new column for cooling type) `{r} reference to df.`. (I need conditional rendering here) The size, construction, and energy consuming features of your home have all been factored into the calculation of the heating and cooling loads for your home:

-   Heating load = `r Building_Audit$"Heating Load"` Btu/hr

-   Cooling load = `r Building_Audit$"Cooling load"`Btu/hr

It is important to make sure that a new heating/cooling system is designed to meet the heating and cooling loads of your home. And please keep in mind that any changes to your home (i.e. – air sealing, insulating, etc…) will ultimately decrease your heating load and can lead to saving money on a new heating system by enabling you to purchase a system with a lower energy output.

## Buildings Electricy use

## Energy Bill analysis

```{r}
#| echo: false
#| warning: false
library(readxl)
library(tidyverse)
```

```{r}
#| echo: false
#| warning: false
#Need to have correct df
table_heating_oil_case_study <- read_excel("../data/table_heating_oil_case_study.xlsx")

table_electricity_case_study <- read_excel("../data/table_electricity_case_study.xlsx")
```

```{r}
#| echo: false
# need ton have correct df
Carriage_heating_oil <- table_heating_oil_case_study |>
  filter(Building == "Carriage") |> #need correct filter 
  mutate()

Carriage_electricity <- table_electricity_case_study |>
  filter(Building == "Carriage  House") |>
  mutate()
```

```{r}
#| echo: false
#| warning: false
ggplot() +
  geom_line(Carriage_heating_oil, mapping = aes(x = `Delivery Date`, y = Gallons), color = "blue") + 
  geom_line(Carriage_electricity, mapping = aes(x = Month, y = KWH), color = "red") +
  scale_y_continuous(
    name = "Gallons",
    sec.axis = sec_axis(trans = ~.*1, name="kWh"))+
  geom_vline(xintercept=as.POSIXct(as.Date("2021-08-01")),
                linetype=3, colour="black") +
   annotate("text", x=as.POSIXct(as.Date("2021-06-01")), y=600, label="David started as the Director of Energy", angle=90) +
  geom_vline(xintercept=as.POSIXct(as.Date("2019-09-01")),
                linetype=3, colour="black") +
   annotate("text", x=as.POSIXct(as.Date("2019-07-01")), y=400, label="Electricity Data collection sarted", angle=90)+
  theme(axis.title.y.left = element_text(colour = "blue"),axis.title.y.right = element_text(colour = "red" ))+
  labs(title = "Carriage's house energy history", subtitle = "Gallons of heating oil and kWh of electricity")
```
