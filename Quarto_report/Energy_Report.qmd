---
title: "Energy Report"
format: html
editor: visual
params:
  adress: "Energy_Audit_template$adress"
---

```{r}
#| label: setup
#| echo: false
#| warning: false

#Attach Packages
library(readr)
library(here)
library(dplyr)
library(ggplot2)
library(stringr)
library(readxl)

#Load Data
Energy_Audits <- read_excel("../data/Energy_Audit_template.xlsx")
```

## Home Energy Audit Report

Photo here of the house SUBMITTED TO: `r Energy_Audits$Adress_Name`

SUBMITTED BY: `r Energy_Audits$Auditor_full_name` DATE: `r format(Sys.time(), '%e %B %Y')`

## The Energy Audit

Energy Audit of your property was conducted on `r Energy_Audits$Audit_Date` We looked into insulation, mechanical equipment, conducted test like blower door test to quantify the energy efficiency of your home. By analyzing collected and all the data that you provided your home energy cost your approximately `r Energy_Audits$Yearly_Energy_Cost` (This report also shows the list of improvements that could lower energy consumption and improve comfort and health)

## Home's current condition

::: {layout-ncol="2"}

Build: `{r} reference to df.`

Volume:

Area: `{r} reference to df.`

Window type and area:

Heating type: `{r} reference to df.`

Door type and area:

Total floor area: `{r} reference to df.`

Net wall area:

Ceiling height:

Ceiling/attic area:
:::

## Health and safety

Combustion Gas Spillage Test – `{r} reference to df.` (Emissions Spilled for `{r} reference to df.` seconds) (#or maybe I can set if the emissions spilled for \>60 seconds than it set's automatic to FAILED)

(This can be optional in a longer report)The Combustion Gas Spillage Test examines your current combustion appliances for spillage of emissions into your home. Most combustion appliances spill for a short period of time, especially when they are first starting. An appliance that spills emissions for more than 60 seconds fails the test and corrective action is needed. This is often due to a clogged or restricted chimney.

Appliance Carbon Monoxide (CO) Test – PASSED (`{r} reference to df.` parts per million) (#or maybe I can set if the emissions spilled for \>26 parts per million than it set's automatic to FAILED)

(This can be optional in a longer report) The Appliance Carbon Monoxide test examines the concentration of CO inside of the chimney/flue that is designed to vent the emissions of the combustion process out of your home. If levels of CO in the emissions of your combustion appliance exceeds 26 parts per million, correction action is highly recommended. If they exceed 100 parts per million corrective action is needed. CO is produced from incomplete combustion, so often times a clean and tune of your appliance is the best fix.

Ambient Carbon Monoxide (CO) Test – PASSED (`{r} reference to df.` parts per million) (#or maybe I can set if the emissions spilled for \>35 parts per million than it set's automatic to FAILED)

(This can be optional in a longer report) The Ambient Carbon Monoxide test examines the inside of your home for the presence of CO. All homes with combustion appliances and/or attached garages must to have UL2034 listed carbon monoxide detectors installed in the appropriate locations. If levels of CO in your home reach 35 parts per million the appliance creating the problem should be disabled and the home should be evacuated and ventilated until levels fall below 35 PPM. The appliance should then be repaired or replaced.

Combustion Appliance Draft Test – `{r} reference to df.` (Sufficient Draft Pressure)

(This can be optional in a longer report) The Combustion Appliance Draft Test evaluates the risk that the combustion gases in your home’s flue(s) will be drawn back into your home by a source of negative pressure (e.g. clothes dryer, bathroom fans, etc…) If a combustion appliance does not have sufficient draft pressure corrective action is required.

Gas leak detection: `{r} reference to df.`

Other Health & Safety Concerns: `{r} reference to df.` if there is some comment if not default to this - (There were no health and safety concerns that were identified at the time of your energy audit.)

## Insulation levels

|                    |                        |                               |
|------------------------|----------------------------|--------------------|
| HOME COMPONENT     | YOUR HOME’S R-VALUES   | US D.O.E.RECOMMENDED R-VALUES |
| Attics/Ceilings    | `{r} reference to df.` | 49                            |
| Above Ground Walls | `{r} reference to df.` | 20                            |
| Basement Walls     | `{r} reference to df.` | 15                            |
| Basement Ceilings  | `{r} reference to df.` | 25                            |

link to US D.O.E. RECOMMENDED R-VALUES

Images of the insulation pictures.

## Air Leakage Test

The blower door test, determined that your homes air leakage rate is `{r} reference to df.`Natural Air Changes per Hour(ACHn) (Should I explain what ACHn is?) CFM50 was `{r} reference to df.` with `{r} reference to df.` ring used. (Include photo)

```{r}
#| label: air_leakage_test
#| warning: false

#Here will be a singular bar plat with air leak visualization
```

The blower door test and visual inspection detected the following areas for moderate to severe air leakage:

`{r} reference to df.{r} reference to df.`

`{r} reference to df.`

`{r} reference to df.`

## 

Heating and Cooling Systems

(Image of heating system) Your home is currently heated with an `{r} reference to df.` Your current heating system has the following efficiency and output ratings: • Heating efficiency = `{r} reference to df.` Annual Fuel Utilization Efficiency (AFUE) • Heating output = `{r} reference to df.`Btu/hr Your home is cooled with `{r} reference to df.`. (I need conditional rendering here) The size, construction, and energy consuming features of your home have all been factored into the calculation of the heating and cooling loads for your home: • Heating load = `{r} reference to df.` Btu/hr • Cooling load = `{r} reference to df.`Btu/hr It is important to make sure that a new heating/cooling system is designed to meet the heating and cooling loads of your home. And please keep in mind that any changes to your home (i.e. – air sealing, insulating, etc…) will ultimately decrease your heating load and can lead to saving money on a new heating system by enabling you to purchase a system with a lower energy output.

\## Energy Bill analysis

```{r}
#| echo: true
#| warning: false
library(readxl)
library(tidyverse)
Sys.Date()
```

```{r}
#| echo: false
#| warning: false
#Need to have correct df
table_heating_oil_case_study <- read_excel("../data/table_heating_oil_case_study.xlsx")

table_electricity_case_study <- read_excel("../data/table_electricity_case_study.xlsx")
```

```{r}
#| echo: false
# need ton have correct df
Carriage_heating_oil <- table_heating_oil_case_study |>
  filter(Building == "Carriage") |> #need correct filter 
  mutate()

Carriage_electricity <- table_electricity_case_study |>
  filter(Building == "Carriage  House") |>
  mutate()
```

```{r}
#| echo: false
#| warning: false
ggplot() +
  geom_line(Carriage_heating_oil, mapping = aes(x = `Delivery Date`, y = Gallons), color = "blue") + 
  geom_line(Carriage_electricity, mapping = aes(x = Month, y = KWH), color = "red") +
  scale_y_continuous(
    name = "Gallons",
    sec.axis = sec_axis(trans = ~.*1, name="kWh"))+
  geom_vline(xintercept=as.POSIXct(as.Date("2021-08-01")),
                linetype=3, colour="black") +
   annotate("text", x=as.POSIXct(as.Date("2021-06-01")), y=600, label="David started as the Director of Energy", angle=90) +
  geom_vline(xintercept=as.POSIXct(as.Date("2019-09-01")),
                linetype=3, colour="black") +
   annotate("text", x=as.POSIXct(as.Date("2019-07-01")), y=400, label="Electricity Data collection sarted", angle=90)+
  theme(axis.title.y.left = element_text(colour = "blue"),axis.title.y.right = element_text(colour = "red" ))+
  labs(title = "Carriage's house energy history", subtitle = "Gallons of heating oil and kWh of electricity")
```
